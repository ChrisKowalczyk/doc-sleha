<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd" [
 <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
 <!ENTITY % entities SYSTEM "entity-decl.ent">
 %entities;
]>
<!-- Fate #305039 -->
<!-- network device bonding for redundancy and performance-->
<chapter id="cha.ha.netbonding">
 <title>Network Device Bonding</title>
 <para>
  For many systems, it is desirable to implement network connections that
  comply to more than the standard data security or availability
  requirements of a typical Ethernet device. In these cases, several
  Ethernet devices can be aggregated to a single bonding device.
 </para>
 <para>
  The configuration of the bonding device is done by means of bonding module
  options. The behavior is determined through the mode of the bonding
  device. By default, this is <systemitem>mode=active-backup</systemitem>,
  which means that a different slave device will become active if the active
  slave fails.
 </para>
 <para>
  When using &ais;, the bonding device is not managed by the cluster
  software. Therefore, the bonding device must be configured on each cluster
  node that might possibly need to access the bonding device.
 </para>
<!--
  <tip>
   <title>Bonding and Xen</title>
   <para>
    Using bonding devices is only interesting for machines that have
    multiple real network cards available. In most configurations, this means
    that you should use the bonding configuration only in &dom0;. Only if you
    have multiple network cards assigned to a &vmguest; system it may also be
    useful to setup the bond in a &vmguest;.
   </para>
   </tip> -->
 <sect1 id="sec.ha.netbondig.yast">
  <title>Configuring Bonding Devices with &yast;</title>

  <para>
   To configure a bonding device, you need to have multiple Ethernet devices
   that can be aggregated to a single bonding device. Proceed as follows:
  </para>

  <procedure>
   <step>
    <para>
     Start &yast; as &rootuser; and select <menuchoice> <guimenu>Network
     Devices</guimenu> <guimenu>Network Settings</guimenu> </menuchoice>.
    </para>
   </step>
   <step>
    <para>In the <guimenu>Network Settings</guimenu>, switch to the
      <guimenu>Overview</guimenu> tab, which shows the already configured
      devices.</para>
   </step>
   <step>
    <para>Check if the Ethernet devices to aggregate to a bonding device have an IP address
    assigned. If yes, change that:</para>
    <substeps>
     <step>
      <para>Select the device to change and click <guimenu>Edit</guimenu>.</para>
     </step>
     <step id="step.bond.slave">
      <para>In the <guimenu>Address</guimenu> tab of the <guimenu>Network Card
        Setup</guimenu> dialog that opens, select the option 
       <guimenu>No Link and IP Setup (Bonding Slaves)</guimenu>.</para>
     </step>
     <step>
      <para>Click <guimenu>Next</guimenu> to return to the
        <guimenu>Overview</guimenu> tab in the <guimenu>Network
        Settings</guimenu> dialog.</para>
     </step>
    </substeps>
    </step>
   <step>
    <para>To add a new bonding device, click <guimenu>Add</guimenu> and set the
      <guimenu>Device Type</guimenu> to <guimenu>Bond</guimenu>. Proceed with
      <guimenu>Next</guimenu>. </para>
   <!-- <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="bond_configuration.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="bond_configuration.png" width="65%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>-->
   </step>
   <step>
    <para>
     Select how to assign the IP address to the bonding device. Three
     methods are at your disposal:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       No Link and IP Setup (Bonding Slaves)
      </para>
     </listitem>
     <listitem>
      <para>
       Dynamic Address (with DHCP or Zeroconf)
      </para>
     </listitem>
     <listitem>
      <para>
       Statically assigned IP Address
      </para>
     </listitem>
    </itemizedlist>
    <para>
     Use the method that is appropriate for your environment. If &ais;
     manages virtual IP addresses, select <guimenu>Statically assigned IP
     Address</guimenu> and assign a basic IP address to the interface.
    </para>
   </step>
   <step>
    <para>
     Switch to the <guimenu>Bond Slaves</guimenu> tab.
    </para>
   </step>
   <step>
    <para>It shows any Ethernet devices that have been configured as bonding
     slaves in <xref linkend="step.bond.slave" xrefstyle="select:label
      nopage"/>.  To select the Ethernet devices that you want to include into the bond,
     activate the check box in front of the relevant <guimenu>Bond
     Slave</guimenu>.
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="yast2_netw_bond.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="yast2_netw_bond.png" width="65%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     Edit the <guimenu>Bond Driver Options</guimenu>. The following modes
     are available:
    </para>
    <variablelist>
     <varlistentry>
      <term><literal>balance-rr</literal>
      </term>
      <listitem>
       <para>
        Provides load balancing and fault tolerance.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>active-backup</literal>
      </term>
      <listitem>
       <para>
        Provides fault tolerance.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>balance-xor</literal>
      </term>
      <listitem>
       <para>
        Provides load balancing and fault tolerance.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>broadcast</literal>
      </term>
      <listitem>
       <para>
        Provides fault tolerance
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>802.3ad</literal>
      </term>
      <listitem>
       <para>
        Provides dynamic link aggregation if supported by the connected
        switch.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>balance-tlb</literal>
      </term>
      <listitem>
       <para>
        Provides load balancing for outgoing traffic.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>balance-alb</literal>
      </term>
      <listitem>
       <para>
        Provides load balancing for incoming and outgoing traffic, if the
        network devices used allow the modifying of the network device's
        hardware address while in use.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     Make sure to add the parameter <literal>miimon=100</literal> to
     <guimenu>Bond Driver Options</guimenu>. Without this parameter, the
     data integrity is not checked regularly.
    </para>
   </step>
   <step>
    <para> Click <guimenu>Next</guimenu> and leave &yast; with
      <guimenu>OK</guimenu> to finish the configuration of the bonding device.
     &yast; writes the configuration to
       <filename>/etc/sysconfig/network/ifcfg-bond<replaceable>DEVICENUMBER</replaceable></filename>.
    </para>
   </step>
  </procedure>
  <!--todo: fate#312287 (SP3), fate#311403 (SP3)-->
 </sect1>
 <sect1 id="sec.ha.netbonding.more">
  <title>For More Information</title>

  <para>
   All modes, as well as many other options, are explained in detail in the
   <guimenu>Linux Ethernet Bonding Driver HOWTO</guimenu>, which can be
   found at
   <filename>/usr/src/linux/Documentation/networking/bonding.txt</filename>
   once you have installed the package
   <systemitem>kernel-source</systemitem>.
  </para>

<!-- 
  http://www.cyberciti.biz/howto/question/static/linux-ethernet-bonding-driver-howto.php
  - this is not as fresh as the kernel documentation!
-->
 </sect1>
</chapter>
