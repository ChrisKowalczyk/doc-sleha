<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd" [
 <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
 <!ENTITY % entities SYSTEM "entity-decl.ent">
 %entities;
]>
<!-- Fate #305039 -->
<!-- network device bonding for redundancy and performance-->
<chapter id="cha.ha.netbonding">
 <title>Network Device Bonding</title>
 <para>
  For many systems, it is desirable to implement network connections that
  comply to more than the standard data security or availability
  requirements of a typical ethernet device. In these cases, several
  ethernet devices can be aggregated to a single bonding device.
 </para>
 <para>
  The configuration of the bonding device is done by means of bonding module
  options. The behavior is determined through the mode of the bonding
  device. By default, this is <systemitem>mode=active-backup</systemitem>,
  which means that a different slave device will become active if the active
  slave fails.
 </para>
 <para>
  When using &ais;, the bonding device is not managed by the cluster
  software. Therefore, the bonding device must be configured on each cluster
  node that might possibly need to access the bonding device.
 </para>
<!--
  <tip>
   <title>Bonding and Xen</title>
   <para>
    Using bonding devices is only interesting for machines that have
    multiple real network cards available. In most configurations, this means
    that you should use the bonding configuration only in &dom0;. Only if you
    have multiple network cards assigned to a &vmguest; system it may also be
    useful to setup the bond in a &vmguest;.
   </para>
   </tip> -->
 <sect1 id="sec.ha.netbondig.yast">
  <title>Configuring a Bonding Device with &yast;</title>

  <para>
   To configure a bonding device, use the following procedure:
  </para>

  <procedure>
   <step>
    <para>
     Start &yast; as &rootuser; and select <menuchoice> <guimenu>Network
     Devices</guimenu> <guimenu>Network Settings</guimenu> </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Click <guimenu>Add</guimenu> to configure a new network card and change
     the <guimenu>Device Type</guimenu> to <guimenu>Bond</guimenu>. Proceed
     with <guimenu>Next</guimenu>.
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="bond_configuration.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="bond_configuration.png" width="65%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
   </step>
   <step>
    <para>
     Select how to assign the IP address to the bonding device. Three
     methods are at your disposal:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       No IP Address
      </para>
     </listitem>
     <listitem>
      <para>
       Dynamic Address (with DHCP or Zeroconf)
      </para>
     </listitem>
     <listitem>
      <para>
       Statically assigned IP Address
      </para>
     </listitem>
    </itemizedlist>
    <para>
     Use the method that is appropriate for your environment. If &ais;
     manages virtual IP addresses, select <guimenu>Statically assigned IP
     Address</guimenu> and assign a basic IP address to the interface.
    </para>
   </step>
   <step>
    <para>
     Switch to the <guimenu>Bond Slaves</guimenu> tab.
    </para>
   </step>
   <step>
    <para>
     To select the ethernet devices that need to be included into the bond,
     activate the check box in front of the relevant <guimenu>Bond
     Slave</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Edit the <guimenu>Bond Driver Options</guimenu>. The following modes
     are available:
    </para>
    <variablelist>
     <varlistentry>
      <term><literal>balance-rr</literal></term>
      <listitem>
       <para>
        Provides load balancing and fault tolerance.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>active-backup</literal></term>
      <listitem>
       <para>
        Provides fault tolerance.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>balance-xor</literal></term>
      <listitem>
       <para>
        Provides load balancing and fault tolerance.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>broadcast</literal></term>
      <listitem>
       <para>
        Provides fault tolerance
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>802.3ad</literal></term>
      <listitem>
       <para>
        Provides dynamic link aggregation if supported by the connected
        switch.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>balance-tlb</literal></term>
      <listitem>
       <para>
        Provides load balancing for outgoing traffic.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>balance-alb</literal></term>
      <listitem>
       <para>
        Provides load balancing for incoming and outgoing traffic, if the
        network devices used allow the modifying of the network device's
        hardware address while in use.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>
     Make sure that the parameter <literal>miimon=100</literal> is added to
     <guimenu>Bond Driver Options</guimenu>. Without this parameter, the
     data integrity is not checked regularly.
    </para>
   </step>
   <step>
    <para>
     Click <guimenu>Next</guimenu> and leave &yast; with
     <guimenu>Ok</guimenu> to create the device.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sec.ha.netbonding.more">
  <title>For More Information</title>

  <para>
   All modes, as well as many other options, are explained in detail in the
   <guimenu>Linux Ethernet Bonding Driver HOWTO</guimenu>, which can be
   found at
   <filename>/usr/src/linux/Documentation/networking/bonding.txt</filename>
   once you have installed the package
   <systemitem>kernel-source</systemitem>.
  </para>

<!-- 
  http://www.cyberciti.biz/howto/question/static/linux-ethernet-bonding-driver-howto.php
  - this is not as fresh as the kernel documentation!
-->
 </sect1>
</chapter>
