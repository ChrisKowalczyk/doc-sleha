<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd" [
 <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
 <!ENTITY % entities SYSTEM "entity-decl.ent">
 %entities;
]>
<chapter id="cha.ha.configuration.hawk">
 <title>Managing Cluster Resources with the Web Interface</title>
 <abstract>
  <para>
   In addition to the <command>crm</command> command line tool and the
   &hbgui; the &hasi; also comes with the &hawk;, a Web-based user interface
   for management tasks. It allows you to monitor and administer your Linux
   cluster also from non-Linux machines. Furthermore, it is an ideal
   solution in case your system does not provide or allow a graphical user
   interface.
  </para>

  <para>
   The Web interface is included in the
   <systemitem class="resource"
    >hawk</systemitem> package. It must be
   installed on all cluster nodes you want to connect to with the &hawk;. On
   the machine from which you want to access a cluster node using the
   &hawk;, you only need a (graphical) Web browser with JavaScript and
   cookies enabled to establish the connection.
  </para>
 </abstract>
 <note>
  <title>User Authentication</title>
  <para>
   To log in to the cluster from the &hawk;, the respective user must be a
   member of the <systemitem class="groupname">haclient</systemitem> group.
   The installation creates a Linux user named
   <systemitem class="username"
    >hacluster</systemitem> which is member
   of the <systemitem class="groupname"
    >haclient</systemitem> group.
  </para>
  <para>
   Before using the &hawk;, either set a password for the
   <systemitem>hacluster</systemitem> user or create a new user which is
   member of the <systemitem class="groupname">haclient</systemitem> group.
  </para>
  <para>
   Do this on every node you will connect to with the &hawk;.
  </para>
 </note>
 <sect1 id="sec.ha.config.hawk.intro">
  <title>Starting the &hawk; and Logging In</title>

  <procedure id="pro.ha.start.hawk">
   <title>Starting the &hawk;</title>
   <para> To use &hawk;, the respective Web service must be started on the
    node that you want to connect to with the Web interface. <remark>taroth
     2010-04-15: port number has changed from 4444 to 7630 for RC3 (IANA
     registration)</remark>For communication,
    the standard HTTP(s) protocol and port <literal>7630</literal> is used.
   </para>
   <step>
    <para>
     On the node you want to connect to, open a shell and log in as
     &rootuser;.
    </para>
   </step>
   <step>
    <para>
     Check the status of the service by entering
    </para>
<screen>rchawk status</screen>
   </step>
   <step>
    <para>
     If the service is not running, start it with
    </para>
<screen>rchawk start</screen>
    <para>
     If you want the &hawk; to start automatically at boot time, execute the
     following command:
    </para>
<screen>chkconfig hawk on</screen>
   </step>
   <step>
    <para>
     <remark>taroth 2010-03-03: tserong, do we have any restrictions regarding
      the browsers we support (or that have been tested with hawk)? tserong: any
      modern graphical web browser with JavaScript and cookies enabled - if we
      need an explicit supported browser statement, then I'd say: Firefox 3.0+,
      IE 7.0+</remark>
     On any machine, start a Web browser and make sure that JavaScript and
     cookies are enabled.
    </para>
   </step>
   <step>
    <para>
     Point it at the IP address or hostname of any cluster node, or the
     address of any <literal>IPaddr(2)</literal> resource that you may have
     configured:
     <remark>taroth 2010-04-15: port number has changed from 4444 to 7630 for
      RC3 (IANA registration)</remark>
    </para>
    <screen>https://<replaceable>IPaddress</replaceable>:7630/</screen>
    <note>
     <title>Certificate Warning</title>
     <para>
      Depending on your browser and browser options, you may get a
      certificate warning when trying to access the URL for the first time.
      This is because the &hawk; uses a self-signed certificate that is not
      considered trustworthy per default.
     </para>
     <para>
      To proceed anyway, you can add an exception in the browser to bypass
      the warning. To avoid the warning in the first place, the self-signed
      certificate can also be replaced with a certificate signed by an
      official Certificate Authority. For information on how to do so, refer
      to <xref
       linkend="vle.ha.hawk.certificate"/>.
     </para>
    </note>
   </step>
   <step>
    <para>
     On the &hawk; login screen, enter the <guimenu>Username</guimenu> and
     <guimenu>Password</guimenu> of the
     <systemitem class="username"
      >hacluster</systemitem> user (or of
     any other user that is member of the
     <systemitem class="groupname">haclient</systemitem> group) and click
     <guimenu>Log In</guimenu>.
    </para>
    <para>
     The <guimenu>Cluster Status</guimenu> screen appears, displaying the
     status of your cluster nodes and resources similar to the output of the
     <command>crm_mon</command>.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1>
  <title>Using &hawk;</title>

  <para>
   After logging in, &hawk; displays the most important global cluster
   parameters and the status of your cluster nodes and resources. The
   following color code is used for status display:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Green: OK. For example, the resource is running or the node is online.
    </para>
   </listitem>
   <listitem>
    <para>
     Red: Bad, unclean. For example, the resource has failed or the node was
     not shut down cleanly.
    </para>
   </listitem>
   <listitem>
    <para>
     Yellow: In transition. For example, the node is currently being shut
     down.
    </para>
   </listitem>
   <listitem>
    <para>
     Grey: Not running, but the cluster expects it to be running. For
     example, nodes that the administrator has stopped or put into
     <literal>standby</literal> mode. Also nodes that are offline are
     displayed in grey (if they have been shut down cleanly).
    </para>
   </listitem>
  </itemizedlist>

  <figure pgwide="0">
   <title>&hawk;&mdash;Cluster Status</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-cluster-status.png" width="80%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-cluster-status.png" width="80%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   Click the arrow symbols in the <guimenu>Nodes</guimenu> and
   <guimenu>Resources</guimenu> groups to expand and collapse the tree view.
  </para>

  <para>
   If a resource has failed, a failure message with the details is shown in
   red at the top of the screen.
  </para>

  <para>
   Click the wrench icon at the right side of a node or resource to access a
   context menu that allows some actions, like starting, stopping or
   cleaning up a resource (or putting a node into <literal>online</literal>
   or <literal>standby</literal> mode or to fence a node).
  </para>

  <para>
   Currently, the &hawk; only allows basic operator tasks but more functions
   will be added in the future, for example, the ability to configure
   resources and nodes.
  </para>
 </sect1>
 <sect1 id="sec.ha.config.hawk.trouble">
  <title>Troubleshooting</title>

  <variablelist>
   <varlistentry>
    <term>&hawk; Log Files</term>
    <listitem>
     <para>
      Find the &hawk; log files in <filename>/srv/www/hawk/log</filename>.
      It is useful to check them in case you cannot access the &hawk; at all
      for some reason.
     </para>
     <para>
      If you have trouble starting or stopping a resource with the &hawk;,
      check the log files that Pacemaker logs to&mdash;by default,
      <filename>/var/log/messages</filename>) .
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Authentication Fails</term>
    <listitem>
     <para>
      If you cannot log in to &hawk; with a new user you added to the
      <systemitem class="groupname">haclient</systemitem> group (or if you
      experience delays until &hawk; accepts logins from this user), stop
      the <systemitem class="daemon">rcnscd</systemitem> daemon with
      <command>rcnscd&nbsp;stop</command> and try again.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry id="vle.ha.hawk.certificate">
    <term>Replacing the Self-Signed Certificate</term>
    <listitem>
     <para>
      To avoid the warning about the self-signed certificate on first
      startup of the &hawk;, replace the automatically created certificate
      with your own certificate or a certificate that was signed by an
      official Certificate Authority (CA).
     </para>
     <para>
      The certificate is stored in
      <filename>/etc/lighttpd/certs/hawk-combined.pem</filename> and
      contains both key and certificate. After you have created or received
      your new key and certificate, combine them by executing the following
      command:
     </para>
<screen>cat <replaceable>keyfile</replaceable> <replaceable>certificationfile</replaceable> > /etc/lighttpd/certs/hawk-combined.pem</screen>
     <para>
      Change the permissions to make the file only accessible by &rootuser;:
     </para>
<screen>chown root.root /etc/lighttpd/certs/hawk-combined.pem
chmod 600 /etc/lighttpd/certs/hawk-combined.pem</screen>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>
