<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd" [
 <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
 <!ENTITY % entities SYSTEM "entity-decl.ent">
 %entities;
]>
<!--taroth 2011-08-22: todo fates #309100, #303620, #310135, #310186, 87, 88,
 89, 90, 91, #310303, #310359-->
<chapter id="cha.ha.configuration.hawk">
 <title>Configuring and Managing Cluster Resources (Web Interface)</title>
 <abstract>
  <para>
   In addition to the <command>crm</command> command line tool and the
   &hbgui; the &hasi; also comes with the &haweb; (&hawk;), a Web-based user interface
   for management tasks. It allows you to monitor and administer your Linux
   cluster also from non-Linux machines. Furthermore, it is an ideal
   solution in case your system does not provide or allow a graphical user
   interface.
  </para>
  <para>
   <remark>taroth 2011-11-04: check what hawk can do and adjust
    accordingly</remark> This chapter introduces &hawk; and covers basic tasks needed
   when configuring and managing cluster resources: modifying global cluster
   options, creating basic and advanced types of resources (groups and clones),
   configuring constraints, specifying failover nodes and failback nodes,
   configuring resource monitoring, starting, cleaning up or removing resources,
   and migrating resources manually. </para>

  <para> The Web interface is included in the <systemitem class="resource"
    >hawk</systemitem> package. It must be installed on all cluster nodes you
   want to connect to with &hawk;. On the machine from which you want to
   access a cluster node using &hawk;, you only need a (graphical) Web
   browser with JavaScript and cookies enabled to establish the connection.
  </para>
 </abstract>
 <note>
  <title>User Authentication</title>
  <para>
   To log in to the cluster from &hawk;, the respective user must be a
   member of the <systemitem class="groupname">haclient</systemitem> group.
   The installation creates a Linux user named
   <systemitem class="username"
    >hacluster</systemitem> which is member
   of the <systemitem class="groupname"
    >haclient</systemitem> group.
  </para>
  <para>
   Before using &hawk;, either set a password for the
   <systemitem>hacluster</systemitem> user or create a new user which is
   member of the <systemitem class="groupname">haclient</systemitem> group.
  </para>
  <para>
   Do this on every node you will connect to with &hawk;.
  </para>
 </note>
 <sect1 id="sec.ha.config.hawk.intro">
  <title>&hawk;&mdash;Overview</title>
  <para/>
  <sect2 id="sec.ha.config.hawk.intro.connect">
   <title>Starting &hawk; and Logging In</title>
   <procedure id="pro.ha.hawkstart">
    <title>Starting &hawk;</title>
    <para>To use &hawk;, the respective Web service must be started on the
     node that you want to connect to with the Web interface. For communication,
     the standard HTTP(s) protocol and port <literal>7630</literal> is used. </para>
    <step>
     <para>On the node you want to connect to, open a shell and log in as
      &rootuser;. </para>
    </step>
    <step>
     <para> Check the status of the service by entering </para>
     <screen>rchawk status</screen>
    </step>
    <step>
     <para> If the service is not running, start it with </para>
     <screen>rchawk start</screen>
     <para> If you want &hawk; to start automatically at boot time, execute
      the following command: </para>
     <screen>chkconfig hawk on</screen>
    </step>
   </procedure>
   <procedure id="pro.ha.hawk.login">
    <!-- <remark>taroth 2010-03-03: tserong, do we have any restrictions regarding
    the browsers we support (or that have been tested with hawk)? tserong: any
    modern graphical web browser with JavaScript and cookies enabled - if we
    need an explicit supported browser statement, then I'd say: Firefox 3.0+,
    IE 7.0+</remark>-->
    <step>
     <para> On any machine, start a Web browser and make sure that JavaScript
      and cookies are enabled. </para>
    </step>
    <step>
     <para> Point it at the IP address or hostname of any cluster node, or the
      address of any <literal>IPaddr(2)</literal> resource that you may have
      configured: </para>
     <screen>https://<replaceable>IPaddress</replaceable>:7630/</screen>
     <note>
      <title>Certificate Warning</title>
      <para> Depending on your browser and browser options, you may get a
       certificate warning when trying to access the URL for the first time.
       This is because &hawk; uses a self-signed certificate that is not
       considered trustworthy per default. </para>
      <para> To proceed anyway, you can add an exception in the browser to
       bypass the warning. To avoid the warning in the first place, the
       self-signed certificate can also be replaced with a certificate signed by
       an official Certificate Authority. For information on how to do so, refer
       to <xref linkend="vle.ha.hawk.certificate"/>. </para>
     </note>
    </step>
    <step>
     <para> On the &hawk; login screen, enter the
       <guimenu>Username</guimenu> and <guimenu>Password</guimenu> of the
       <systemitem class="username">hacluster</systemitem> user (or of any other
      user that is member of the <systemitem class="groupname"
       >haclient</systemitem> group) and click <guimenu>Log In</guimenu>. </para>
     <para> The <guimenu>Cluster Status</guimenu> screen appears, displaying the
      status of your cluster nodes and resources similar to the output of the
      <command>crm_mon</command>. </para>
    </step>
   </procedure>
  </sect2>
  <sect2 id="sec.ha.configuration.hawk.intro.main">
   <title>Main Screen</title>

   <para>After logging in, &hawk; displays a summary with the most important
    global cluster parameters and the status of your cluster nodes and
    resources. The following color code is used for status display: </para>

   <itemizedlist>
    <listitem>
     <para> Green: OK. For example, the resource is running or the node is
      online. </para>
    </listitem>
    <listitem>
     <para> Red: Bad, unclean. For example, the resource has failed or the node
      was not shut down cleanly. </para>
    </listitem>
    <listitem>
     <para> Yellow: In transition. For example, the node is currently being shut
      down. </para>
    </listitem>
    <listitem>
     <para> Grey: Not running, but the cluster expects it to be running. For
      example, nodes that the administrator has stopped or put into
       <literal>standby</literal> mode. Also nodes that are offline are
      displayed in gray (if they have been shut down cleanly). </para>
    </listitem>
   </itemizedlist>
   <para> If a resource has failed, a failure message with the details is shown
    in red at the top of the screen. </para>

   <!--screenshot needs update-->
   <figure pgwide="0">
    <title>&hawk;&mdash;Cluster Status</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="hawk-cluster-status.png" width="80%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="hawk-cluster-status.png" width="80%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>

   <para>Use the icons in the upper right corner to switch between 3 different
    views:</para>
   <variablelist>
    <varlistentry>
     <term>Summary View</term>
     <listitem>
      <para>Shows the most important global cluster parameters and the status of
       your cluster nodes and resources at one glance. To see more details for a
       certain node or resource, click the respective entries that are marked as
       links. </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Tree View</term>
     <listitem>
      <para>Presents an expandable view of the most important global cluster
       parameters and the status of your cluster nodes and resources. Click the
       arrows to expand or collapse the elements belong to the respective
       category. In contrast to the <guimenu>Summary View</guimenu> this view
       not only shows the resources' ID and status but also the resources' type
       (for example, if it is a primitive, clone, or group).</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Table View</term>
     <listitem>
      <para>This view is especially useful for larger clusters, because it shows
       in a concise way which resources are currently running on which node.
       Additionally, it lists the resources that are inactive (stopped).
        <remark>taroth 2011-11-07: DEVs, which states are shown here: also
        failed resources? or only stopped ones? </remark>
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
      <para>
    <remark>taroth 2011-11-07: DEVs, what's the default refresh interval for the
    UI? 15 seconds?</remark></para>
   <para>To trigger any actions, use the icon bar at the left side of the screen
    or click the wrench icon at the right side of an entry to access a context
    menu. </para>
  </sect2>
 </sect1>
 <sect1 id="sec.ha.config.hawk.global">
  <title>Configuring Global Cluster Options</title>
  
  <para>
   Global cluster options control how the cluster behaves when confronted
   with certain situations. They are grouped into sets and can be viewed and
   modified with the cluster management tools like &hbgui;, &hawk;, and
   <command>crm</command> shell. The predefined values can be kept in most
   cases. However, to make key functions of your cluster work correctly, you
   need to adjust the following parameters after basic cluster setup:
  </para>
  
  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="sec.ha.configuration.basics.global.quorum"
      xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec.ha.configuration.basics.global.stonith"
      xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>
  
  <procedure id="pro.ha.config.hawk.global">
   <title>Modifying Global Cluster Options</title>
   <step>
    <para>
     Log in to &hawk; as described in
     <xref
      linkend="sec.ha.config.hawk.intro.connect"/>.
    </para>
   </step>
   <!--<step>
    <para>
     Select <menuchoice> <guimenu>View</guimenu> <guimenu>Simple
      Mode</guimenu> </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     In the left pane, select <guimenu>CRM Config</guimenu> to view the
     global cluster options and their current values.
    </para>
   </step>
   <step>
    <para>
     Depending on your cluster requirements, set <guimenu>No Quorum
      Policy</guimenu> to the appropriate value.
    </para>
   </step>
   <step>
    <para>
     If you need to disable fencing for any reasons, deselect
     <literal>Stonith Enabled</literal>.
    </para>
   </step>
   <step>
    <para>
     Confirm your changes with <guimenu>Apply</guimenu>.
    </para>
   </step>-->
  </procedure>
  
  <!--<para>
   You can at any time switch back to the default values for all options by
   selecting <guimenu>CRM Config</guimenu> in the left pane and clicking
   <guimenu>Default</guimenu>.
  </para>-->
 </sect1>
 <!--<sect1>
  <title>Using &hawk;</title>

  
  <para>
   Click the arrow symbols in the <guimenu>Nodes</guimenu> and
   <guimenu>Resources</guimenu> groups to expand and collapse the tree view.
  </para>

 
  <para>
   Click the wrench icon at the right side of a node or resource to access a
   context menu that allows some actions, like starting, stopping or
   cleaning up a resource (or putting a node into <literal>online</literal>
   or <literal>standby</literal> mode or to fence a node).
  </para>

  <para>
   Currently, &hawk; only allows basic operator tasks but more functions
   will be added in the future, for example, the ability to configure
   resources and nodes.
  </para>
  </sect1>-->
 <sect1 id="sec.ha.config.hawk.trouble">
  <title>Troubleshooting</title>

  <variablelist>
   <varlistentry>
    <term>&hawk; Log Files</term>
    <listitem>
     <para>
      Find the &hawk; log files in <filename>/srv/www/hawk/log</filename>.
      It is useful to check them in case you cannot access &hawk; at all
      for some reason.
     </para>
     <para>
      If you have trouble starting or stopping a resource with &hawk;,
      check the log files that Pacemaker logs to&mdash;by default,
      <filename>/var/log/messages</filename>) .
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Authentication Fails</term>
    <listitem>
     <para>
      If you cannot log in to &hawk; with a new user you added to the
      <systemitem class="groupname">haclient</systemitem> group (or if you
      experience delays until &hawk; accepts logins from this user), stop
      the <systemitem class="daemon">rcnscd</systemitem> daemon with
      <command>rcnscd&nbsp;stop</command> and try again.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry id="vle.ha.hawk.certificate">
    <term>Replacing the Self-Signed Certificate</term>
    <listitem>
     <para>
      To avoid the warning about the self-signed certificate on first
      &hawk; startup, replace the automatically created certificate
      with your own certificate or a certificate that was signed by an
      official Certificate Authority (CA).
     </para>
     <para>
      The certificate is stored in
      <filename>/etc/lighttpd/certs/hawk-combined.pem</filename> and
      contains both key and certificate. After you have created or received
      your new key and certificate, combine them by executing the following
      command:
     </para>
<screen>cat <replaceable>keyfile</replaceable> <replaceable>certificatefile</replaceable> > /etc/lighttpd/certs/hawk-combined.pem</screen>
     <para>
      Change the permissions to make the file only accessible by &rootuser;:
     </para>
<screen>chown root.root /etc/lighttpd/certs/hawk-combined.pem
chmod 600 /etc/lighttpd/certs/hawk-combined.pem</screen>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>
