<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<!-- Converted by suse-upgrade version 1.1 -->

<chapter xml:id="cha.ha.config.hawk2" 
 xmlns="http://docbook.org/ns/docbook"
 xmlns:xi="http://www.w3.org/2001/XInclude" 
 xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
 <title>Configuring and Managing Cluster Resources with &hawk;2</title>
 <info>
  <abstract>
   <para>
  To configure and manage cluster resources, &productname; 
  either use &haweb;
  (&hawk;), a Web-based user interface, or the &crmshell;
  (&crmsh;) command line utility.
  </para>
      
        <para>
    &hawk; allows you to monitor and administer your Linux cluster from
    non-Linux machines as well. Furthermore, it is the ideal solution in
    case your system only provides a minimal graphical user interface.
   </para>
       <!-- <para>
    This chapter introduces &hawk; and covers basic tasks for configuring
    and managing cluster resources: modifying global cluster options,
    creating basic and advanced types of resources (groups and clones),
    configuring constraints, specifying failover nodes and failback nodes,
    configuring resource monitoring, starting, cleaning up or removing
    resources, and migrating resources manually. For detailed analysis of
    the cluster status, &hawk; generates a cluster report
    (<literal>hb_report</literal>). You can view the cluster history or
    explore potential failure scenarios with the simulator.
   </para>-->
   </abstract>
   <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>
 <note>
  <title>&hawk; Versions</title>
  <para>&productname; 12 SP1 ships with two &hawk; versions in
   parallel:</para>
  <itemizedlist>
   <listitem>
    <para>&hawk; version <literal>1</literal>(included in RPM package:
      <systemitem class="resource">hawk</systemitem>). For the documentation of
     this &hawk; version, see <xref linkend="cha.ha.config.hawk"/>.</para>
   </listitem>
   <listitem>
    <para>&hawk; version <literal>2</literal> (included in RPM package
      <systemitem class="resource">hawk2</systemitem>). This version is
     documented in the current chapter.</para>
   </listitem>
  </itemizedlist>
 </note>
 
  <sect1 xml:id="sec.ha.config.hawk2.intro">
  <title>&hawk;2&mdash;Overview</title>

  <para>
   &hawk;2's Web interface allows you to monitor and administer your Linux
   cluster from non-Linux machines as well. Furthermore, it is the ideal
   solution in case your system only provides a minimal graphical user
   interface.
  </para>

  <sect2 xml:id="sec.ha.config.hawk2.intro.connect">
   <title>Starting &hawk;2 and Logging In</title>
   <para>
    The Web interface is included in the
    <systemitem class="resource">hawk2</systemitem> package. It must be
    installed on all cluster nodes you want to connect to with &hawk;2. On
    the machine from which you want to access a cluster node using
    &hawk;2, you only need a (graphical) Web browser with JavaScript and
    cookies enabled to establish the connection.
   </para>
   <para>
    To use &hawk;2, the respective Web service must be started on the node
    that you want to connect to via the Web interface.
   </para>
   <para>
    If you have set up your cluster with the scripts from the
    <systemitem class="resource">ha-cluster-bootstrap</systemitem> package,
    the &hawk;2 service is already started. In that case, skip
    <xref linkend="pro.ha.hawk2.service"/> and proceed with
    <xref linkend="pro.ha.hawk2.login"/>.
   </para>
   <procedure xml:id="pro.ha.hawk2.service">
    <title>Starting &hawk;2 Services</title>
    <step>
     <para>
      On the node you want to connect to, open a shell and log in as
      &rootuser;.
     </para>
    </step>
    <step>
     <para>
      Check the status of the service by entering
     </para>
<screen>&prompt.root;<command>systemctl</command> status hawk</screen>
    </step>
    <step>
     <para>
      If the service is not running, start it with
     </para>
<screen>&prompt.root;<command>systemctl</command> start hawk</screen>
     <para>
      If you want &hawk;2 to start automatically at boot time, execute the
      following command:
     </para>
<screen>&prompt.root;<command>systemctl</command> enable hawk</screen>
    </step>
   </procedure>
   <note>
    <title>User Authentication</title>
    <para>
     &hawk;2 users must be members of the
     <systemitem class="groupname">haclient</systemitem> group. The
     installation creates a Linux user named
     <systemitem class="username">hacluster</systemitem>, who is added to
     the <systemitem class="groupname">haclient</systemitem> group. When
     using the <command>ha-cluster-init </command>script for setup, a
     default password is set for the
     <systemitem class="username">hacluster</systemitem> user.
    </para>
    <para>
     Before starting &hawk;2, set or change the password for the
     <systemitem>hacluster</systemitem> user. Alternatively, create a new
     user which is a member of the
     <systemitem class="groupname">haclient</systemitem> group.
    </para>
    <para>
     Do this on every node you will connect to with &hawk;2.
    </para>
   </note>
   <procedure xml:id="pro.ha.hawk2.login">
    <title>Logging In to the &hawk;2 Web Interface</title>
    <para>
     The &hawk;2 Web interface uses the HTTPS protocol and port
     <literal>7630</literal>.
    </para>
    <!--taroth 2015-08-10: fate#318183 (SLE HA 12 SP1)-->
    <note>
     <title>Accessing &hawk;2 Via a Virtual IP</title>
     <para>To access &hawk;2 even in case the cluster node you usually connect to is down, a
      virtual IP address (<literal>IPaddr</literal> or <literal>IPaddr2</literal>) can be configured
      for &hawk;2 as cluster resource. It does not need any special configuration.</para>
    </note>
    <step>
     <para>
      On any machine, start a Web browser and make sure that JavaScript and
      cookies are enabled.
     </para>
    </step>
    <step>
     <para>
      As URL, enter the IP address or host name of any cluster node running
      the &hawk;2 Web service. Alternatively, enter the address of any
      <literal>IPaddr(2)</literal> resource that the cluster operator may
      have configured:
     </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
     <note>
      <title>Certificate Warning</title>
      <para>
       If a certificate warning appears when you try to access the URL for
       the first time, a self-signed certificate is in use. Self-signed
       certificates are not considered trustworthy by default.
      </para>
      <para>
       Ask your cluster operator for the certificate details to verify the
       certificate.
      </para>
      <para>
       To proceed anyway, you can add an exception in the browser to bypass
       the warning.
      </para>
      <para>
       For information on how to replace the self-signed certificate with a
       certificate signed by an official Certificate Authority, refer to
       FIXME <!--<xref linkend="vle.ha.hawk2.certificate"/>-->.
      </para>
     </note>
    </step>
    <step>
     <para>
      On the &hawk;2 login screen, enter the <guimenu>Username</guimenu>
      and <guimenu>Password</guimenu> of the
      <systemitem class="username">hacluster</systemitem> user (or of any
      other user that is a member of the
      <systemitem class="groupname">haclient</systemitem> group).
     </para>
    </step>
    <step>
     <para>
      Click <guimenu>Log In</guimenu>.
     </para>
     <para>
      The <guimenu>Cluster Status</guimenu> screen appears, displaying the
      status of your cluster nodes and resources. The information shown is
      similar to the output of <command>crm status</command> in the
      &crmshell;.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.ha.config.hawk2.intro.main">
   <title>Main Screen: Cluster Status</title>
   <remark>taroth 2014-07-31: todo: this sections needs a serious overhaul and restructuring as a
    lot of new functions and views have been added to Hawk during the last releases - however, it
    makes more sense to postpone this until the next general UI overhaul for Hawk, so
    let's live with the current state for one more release... ;(</remark>
   <para>
    After logging in, &hawk;2 displays the <guimenu>Cluster
    Status</guimenu> screen. It shows a summary with the most important
    global cluster parameters and the status of your cluster nodes and
    resources. The following color code is used for status display of nodes
    and resources:
   </para>
   <itemizedlist xml:id="il.ha.config.hawk2.colors">
    <title>&hawk;2 Color Code</title>
    <listitem>
     <para>
      Green: OK. For example, the resource is running or the node is online.
     </para>
    </listitem>
    <listitem>
     <para>
      Red: Bad, unclean. For example, the resource has failed or the node
      was not shut down cleanly.
     </para>
    </listitem>
    <listitem>
     <para>
      Yellow: In transition. For example, the node is currently being shut
      down or a resource is currently being started or stopped. If you click
      a pending resource to view its details, &hawk;2 also displays the
      state to which the resource is currently changing
      (<literal>Starting</literal>, <literal>Stopping</literal>,
      <literal>Moving</literal>, <literal>Promoting</literal>, or
      <literal>Demoting</literal>).
     </para>
<!--https://bugzilla.novell.com/show_bug.cgi?id=883529: 
      [doc] mention record-pending needs to be set for hawk to display resources in transitional state -->
     <note>
      <title>Displaying Transitional State for Resources</title>
      <para>
       The transitional state for resources is only shown if the operation
       property <varname>record-pending</varname> is set to
       <literal>true</literal>. If you have set up your cluster with the
       <command>ha-cluster-init</command> script, this property is turned on
       globally by default. To enable it manually, either use the &hawk;2
       <guimenu>Cluster Configuration</guimenu> screen to add and enable the
       property below <guimenu>Operation Defaults</guimenu> or use the
       following command:
      </para>
<screen>&prompt.root;<command>crm</command> configure op_defaults record-pending=true</screen>
     </note>
    </listitem>
    <listitem>
     <para>
      Gray: Not running, but the cluster expects it to be running. For
      example, nodes that the administrator has stopped or put into
      <literal>standby</literal> mode. Also nodes that are offline are
      displayed in gray (if they have been shut down cleanly).
     </para>
    </listitem>
   </itemizedlist>
   <para>
    In addition to the color code, &hawk;2 also displays icons for the
    state of nodes, resources, tickets and for error messages in all views
    of the <guimenu>Cluster Status</guimenu> screen.
   </para>
   <para>
    If a resource has failed, an error message with the details is shown in
    red at the top of the screen. To analyze the causes for the failure,
    click the error message. This automatically takes you to &hawk;2's
    <guimenu>History Explorer</guimenu> and triggers the collection of data
    for a time span of 20 minutes (10 minutes before and 10 minutes after
    the failure occurred). For more details, refer to FIXME
    <!--<xref linkend="pro.ha.config.hawk2.history.explorer"/>-->.
   </para>
   <figure pgwide="0">
    <title>&hawk;2&mdash;Cluster Status (Summary View)</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="hawk-cluster-status-main.png" width="90%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="hawk-cluster-status-main.png" width="80%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    The <guimenu>Cluster Status</guimenu> screen refreshes itself in near
    real-time. Choose between the following views, which you can access with
    the three icons in the upper right corner:
   </para>
<!--fate#309100-->
   <variablelist>
    <title>&hawk;2 Cluster Status Views</title>
    <varlistentry>
     <term>Summary View</term>
     <listitem>
      <para>
       Shows the most important global cluster parameters and the status of
       your cluster nodes and resources at the same time. If your setup
       includes &geo; clusters (multi-site clusters), the summary view
       also shows tickets. To view details about all elements belonging to a
       certain category (tickets, nodes, or resources), click the category
       title, which is marked as a link. Otherwise click the individual
       elements for details.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Tree View</term>
     <listitem>
      <para>
       Presents an expandable view of the most important global cluster
       parameters and the status of your cluster nodes and resources. If
       your setup includes &geo; clusters (multi-site clusters), the tree
       view also shows tickets. Click the arrows to expand or collapse the
       elements belonging to the respective category. In contrast to the
       <guimenu>Summary View</guimenu> this view not only shows the IDs and
       status of resources but also the type (for example, primitive, clone,
       or group).
      </para>
<!--https://fate.suse.com/316303: HAWK resource summary on group level-->
      <para>
       For groups, it is also possible to switch to a view where resources
       of the same type (within a group) are presented together. Press the
       <literal>ab</literal> icon in the resources category to toggle
       between the normal view where the resources are displayed
       individually and a view where they are coalesced by type. For
       example, if you have three resources of the type
       <literal>ocf:pacemaker:Dummy</literal> in one group, and only one of
       them is running, the view-by-type view would show <literal>1/3
       ocf:pacemaker:Dummy<replaceable>&nbsp;NODENAME</replaceable></literal>
       on a gray background. This indicates that only 1 of 3 resources has
       already started.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Table View</term>
     <listitem>
      <para>
       This view is especially useful for larger clusters, because it shows
       in a concise way which resources are currently running on which node.
       Inactive nodes or resources are also displayed.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    The top-level row of the main screen shows the user name with which you
    are logged in. It also allows you to <guimenu>Log Out</guimenu> of the
    Web interface, and to access the following <guimenu>Tools</guimenu> from
    the wrench icon next to the user name:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <guimenu>Simulator</guimenu>. For details, refer to FIXME
      <!--<xref linkend="sec.ha.config.hawk2.simulator"/>.-->
     </para>
    </listitem>
<!--fate#313718 (SP3)-->
    <listitem>
     <para>
      <guimenu>Cluster Diagram</guimenu>. Select this entry for a graphical
      representation of the nodes and the resources configured in the CIB.
      The diagram also shows the ordering and colocation between resources
      and node assignments (scores).
     </para>
     <figure xml:id="fig.ha.cluster.diagram.hawk2" pgwide="0">
      <title>&hawk;2&mdash;Cluster Diagram</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="hawk-cluster-diagram.png" width="100%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="hawk-cluster-diagram.png" width="100%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </listitem>
    <listitem>
     <para>
      <guimenu>Cluster Report</guimenu> (<command>hb_report</command>). For
      details, refer to FIXME <!-- <xref linkend="sec.ha.config.hawk2.crmreport"/>-->.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    To perform basic operator tasks on nodes and resources (like starting or
    stopping resources, bringing nodes online, or viewing details), click
    the wrench icon next to the node or resource. This will display a
    context menu.
<!--fate#314388 (SP3)-->
    For any clone, group or multi-state child resource on any of the status
    screens, select the <guimenu>Parent</guimenu> menu item from the context
    menu. Clicking this will let you start, stop, etc. the top-level clone
    or group to which that primitive belongs.
   </para>
   <para>
    For more complex tasks like configuring resources, constraints, or
    global cluster options, use the navigation bar on the left hand side.
    From there, you can access the following screens:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <guimenu>Cluster Status</guimenu>: See FIXME
      <!--<xref linkend="sec.ha.config.hawk2.intro.main"/>--> for details.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>History Explorer</guimenu>: See FIXME
      <!--<xref linkend="pro.ha.config.hawk2.history.explorer"/>--> for details.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Setup Wizard</guimenu>: See FIXME<!--
      <xref linkend="sec.ha.config.hawk2.wizard"/>--> for details.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Cluster Configuration</guimenu>: See FIXME
      <!--<xref linkend="sec.ha.config.hawk2.global"/>--> for details.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Access Control Lists</guimenu>: See
      <xref linkend="cha.ha.acl"/> for details.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Resources</guimenu>: See FIXME
      <!--<xref linkend="sec.ha.config.hawk2.rsc"/>--> for details.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Constraints</guimenu>: See FIXME
      <!--<xref linkend="sec.ha.config.hawk2.rsc"/>--> for details.
     </para>
    </listitem>
   </itemizedlist>
   <note>
    <title>Available Functions in &hawk;2</title>
    <para>
     By default, users logged in as &rootuser; or
     <systemitem class="username">hacluster</systemitem> have full
     read-write access to all cluster configuration tasks. However,
     <xref linkend="cha.ha.acl" xrefstyle="select:title"/> can be used to
     define fine-grained access permissions.
    </para>
    <para>
     If ACLs are enabled in the CRM, the available functions in &hawk;2
     depend on the user role and access permissions assigned to you. In
     addition, the following functions in &hawk;2 can only be executed by
     the user <systemitem class="username">hacluster</systemitem>:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       Generating an <literal>hb_report</literal>.
      </para>
     </listitem>
     <listitem>
      <para>
       Using the <guimenu>History Explorer</guimenu>.
      </para>
     </listitem>
     <listitem>
      <para>
       Viewing recent events for nodes or resources.
      </para>
     </listitem>
    </itemizedlist>
   </note>
  </sect2>
 </sect1>
 <sect1>
  <title/>
  <para/></sect1>
</chapter>