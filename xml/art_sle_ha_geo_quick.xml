<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook50-profile.xsl"
  type="text/xml" 
  title="Profiling step"?>
<!DOCTYPE article
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<!--taroth 2014-12-18: todo for next release: fix IDs in xincludes-->
<?provo dirname="geo_quick/"?>
<article version="5.0" xml:lang="en" xml:id="art.ha.geo.quick"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:dm="urn:x-suse:ns:docmanager"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>&geoquick;</title>
 <subtitle>&productname; &productnumber;</subtitle>
 <info>
  <productnumber>&productnumber;</productnumber>
   <productname>&productname;</productname>
   <date><?dbtimestamp?></date>
    <abstract>
    <para>
     &abstract-geoquick;
     This document guides you through the basic setup of a &geo; cluster,
     using the &geo; cluster bootstrap scripts provided by the
      <systemitem xmlns='http://docbook.org/ns/docbook'
        class='resource'>ha-cluster-bootstrap</systemitem> package.
      </para>
      <para>
        <remark>
          taroth 2017-06-22: todo - more details? restrictions?
        </remark>
      </para>
      </abstract>
      <dm:docmanager>
        <dm:bugtracker>
          <dm:url>https://bugzilla.suse.com/enter_bug.cgi</dm:url>
          <dm:product>SUSE Linux Enterprise High Availability Extension 12 SP3</dm:product>
          <dm:component>GEO Clustering</dm:component>
        </dm:bugtracker>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
 </info>
  <sect1 xml:id="sec.ha.geo.quick.scenario">
    <title>Usage Scenario</title>
    <para>
      &geo; clusters based on &productname; can be considered
      <quote>overlay</quote> clusters where each cluster site corresponds to a
      cluster node in a traditional cluster. The overlay cluster is managed by
      the booth mechanism. It guarantees that the cluster resources will be
      highly available across different cluster sites. This is achieved by using
      cluster objects called tickets that are treated as failover domain between
      cluster sites, in case a site should be down. Booth guarantees that every
      ticket is granted to no more than one site at a time.
    </para>
    <para>
      The procedures in this document will lead to an example setup of a
      &geo; cluster with the following properties:
    </para>
    <example>
      <title>Example Setup of a &geo; Cluster</title>
      <para> A &geo; cluster with two sites,
          <literal>&cluster1;</literal> and
          <literal>&cluster2;</literal>, including one arbitrator. </para>
    </example>
    <para>
      Currently, the &geo; cluster bootstrap script only takes care of setting up
      booth and of creating the minimum set of resources that booth needs.
      <remark>taroth 2017-06-26:
        add link to description of bootstrap scripts</remark>
    </para>
    <para>
      In addition, you need to take the following steps to get a functioning
      &geo; cluster:
      <remark>taroth 2017-06-26: @krig, could you help to provide a list of things that
        the admin needs to execute before/after running the init scripts (in order
        to get a functioning geo cluster)?</remark>
    </para>
  </sect1>
  <sect1 xml:base="sec.ha.geo.quick.req">
    <title>Requirements</title>
    <para>
      <remark>taroth 2017-06-27: todo - for future, use phrases entities like
      in Install Quick</remark>
    </para>
     <itemizedlist>
      <title>Software Requirements</title>
      <listitem>
        <para>
          All clusters that will be part of the &geo; cluster must be based on
          &productname; &productnumber;.
        </para>
      </listitem>
      <listitem>
        <para>
          &slsreg; &productnumber; must be installed on all arbitrators.
        </para>
      </listitem>
      <listitem>
        <para>
          &hageo; must be installed on all cluster nodes
          <emphasis>and</emphasis> on all arbitrators that will be part of the
          &geo; cluster.
          <!--<remark>taroth 2014-08-20: booth package would be enough (GEO pattern only consists of the booth
            package) but to make it clear where to get the package from, phrasing like this</remark>-->
        </para>
      </listitem>
    </itemizedlist>
    
    <itemizedlist>
      <title>Network Requirements</title>
      <listitem>
        <para>
          Each site has a private network routed to the other site:
        </para>
        <itemizedlist>
          <listitem>
            <para>
              &cluster1;: <literal>192.168.201.x</literal>
            </para>
          </listitem>
          <listitem>
            <para>
              &cluster2;: <literal>192.168.202.x</literal>
            </para>
          </listitem>
        </itemizedlist>
      </listitem>
      <listitem>
        <para>
          The sites must be reachable on one UDP and TCP port per booth instance.
          That means any firewalls or IPsec tunnels in between must be configured
          accordingly.
        </para>
      </listitem>
      <listitem>
        <para>
          Other setup decision may require to open more ports (for example, for
          DRBD or database replication).
        </para>
      </listitem>
    </itemizedlist>
    
    <itemizedlist>
      <title>Other Requirements and Recommendations</title>
      <listitem>
        <para>
          All cluster nodes on all sites should synchronize to an NTP server
          outside the cluster. For more information, see the
          <citetitle>&admin;</citetitle> for &sls; &productnumber;,
          available at <link xlink:href="http://www.suse.com/documentation/"/>. Refer to the chapter <citetitle>Time
            Synchronization with NTP</citetitle>.
        </para>
        <para>
          If nodes are not synchronized, log files and cluster reports are very
          hard to analyze.
        </para>
      </listitem>
      <listitem>
        <para>The cluster on each site has a meaningful name, for example:
          <literal>&cluster1;</literal> and
          <literal>&cluster2;</literal>.
        </para>
        <para>
          The cluster names for each site are defined in the respective &corosync.conf; files:
        </para>
        <screen>totem {
          [...]
          cluster_name: &cluster1;
          }
        </screen>
        <para>This can either be done manually (by editing &corosync.conf;) or with the
          &yast; cluster module (by switching to the <guimenu>Communication Channels</guimenu>
          category and defining a <guimenu>Cluster Name</guimenu>).
          Afterward, restart the &pace; service for the changes to take effect.
        </para>
      </listitem>
    </itemizedlist>
  </sect1>
  <sect1 xml:id="sec.ha.geo.scripts">
    <title>Overview of the Bootstrap Scripts</title>
    <para>
      All commands from the <package>ha-cluster-bootstrap</package> package
      execute bootstrap scripts that require only a minimum of time and manual
      intervention.
    </para>
    <itemizedlist>
      <listitem>
        <para>
          With <command>ha-cluster-geo-init</command>, turn a cluster into the first
          member of a &geo; cluster. The script creates &booth.conf; (by taking
          several parameters like the names of the clusters, an arbitrator, and one or
          more tickets). It also configures the following cluster resources needed
          for booth:</para>
        <itemizedlist>
          <listitem>
            <para>A primitive resource for the booth daemon
              (<literal>ocf:pacemaker:booth-site</literal>). It communicates with the
              booth daemons on the other cluster sites.</para>
          </listitem>
          <listitem>
            <para>
              A virtual IP address for each cluster site
              (<literal>ocf:heartbeat:IPaddr2</literal>). It is required by the booth daemon
              who needs a persistent IP address on each cluster site.
            </para>
          </listitem>
          <listitem>
            <para>A cluster resource group (<literal>g-booth</literal>) for both
              primitives.</para>
          </listitem>
        </itemizedlist>
      </listitem>
      <listitem>
        <para>
          With <command>ha-cluster-geo-join</command>, add the current cluster to an
          existing &geo; cluster.
        </para>
      </listitem>
      <listitem>
        <para>
          With <command>ha-cluster-geo-init-arbitrator</command>, make the current node an
          arbitrator for the &geo; cluster.
        </para>
      </listitem>
    </itemizedlist>
    <para>
      All bootstrap scripts log to <filename>/var/log/ha-cluster-bootstrap.log</filename>.
      Check this file for any details of the bootstrap process. Any options set
      during the bootstrap process can be modified later.
    </para>
    <para>Each script comes with a man page covering the range of functions, the
      script's options, and an overview of the files the script can create and modify.
    </para>
  </sect1>
  <sect1 xml:id="sec.ha.geo.quick.inst">
    <title>Installation as Extension</title>
    <para>
      For using the &hasi; and &hageo;, you need the packages included in
      the following installation patterns:
    </para>
    <itemizedlist>
      <listitem>
        <para>
          <literal>&ha;</literal>
        </para>
      </listitem>
      <listitem>
        <para>
          <literal>&geo; Clustering for &ha;</literal>
        </para>
      </listitem>
    </itemizedlist>
    <para>
      Both patterns are only available if you have registered your system at
      &scc; (or a local registration server) and have added the respective
      product channels or installation media as an extension. For information on how
      to install extensions, see the <citetitle>&sle; &productnumber;
        &deploy;</citetitle>, available at <link xlink:href="http://www.suse.com/documentation/"/>. Refer to
      chapter <citetitle>Installing Modules, Extensions, and Third Party Add-On Products</citetitle>.
      <!--taroth: need to use hard-coded link here as the target is not included in the same set-->
    </para>
    <procedure xml:id="pro.ha.geo.inst">
      <title>Installing the Packages</title>
      <step>
        <para>
          To install the packages from both patterns via command line, use
          Zypper:
        </para>
        <screen>sudo <command>zypper</command> in -t pattern ha_sles ha_geo</screen>
      </step>
      <step xml:id="step.ha.geo.inst.yast">
        <para>
          Alternatively, use &yast; for a graphical installation:
        </para>
        <substeps performance="required">
          <step>
            <para>
              Start &yast; as &rootuser; user and select <menuchoice>
                <guimenu>Software</guimenu> <guimenu>Software Management</guimenu>
              </menuchoice>.
            </para>
          </step>
          <step>
            <para>
              Click <menuchoice> <guimenu>View</guimenu>
                <guimenu>Patterns</guimenu> </menuchoice> and activate the following
              patterns:
            </para>
            <itemizedlist>
              <listitem>
                <para>
                  <literal>&ha;</literal>
                </para>
              </listitem>
              <listitem>
                <para>
                  <literal>&geo; Clustering for &ha;</literal>
                </para>
              </listitem>
            </itemizedlist>
          </step>
          <step>
            <para>
              Click <guimenu>Accept</guimenu> to start installing the packages.
            </para>
          </step>
        </substeps>
      </step>
    </procedure>
    <important>
      <title>Installing Software Packages on all Parties</title>
      <para>
        The software packages needed for &ha; and &geo; clusters are
        <emphasis>not</emphasis> automatically copied to the cluster nodes.
      </para>
      <itemizedlist>
        <listitem>
          <para>
            Install &sls; &productnumber; and the <literal>&ha;</literal>
            and <literal>&geo; Clustering for &ha;</literal> patterns on
            <emphasis>all</emphasis> machines that will be part of your &geo;
            cluster.
          </para>
        </listitem>
        <listitem>
          <para>
            If you do not want to install the packages manually on all nodes that
            will be part of your cluster, use &ay; to clone existing nodes.
            Find more information in the <citetitle>&haguide;</citetitle> for
            &productname; &productnumber;, available from
            <link xlink:href="http://www.suse.com/documentation/"/>. Refer to the
            chapter <citetitle>Installation the &hasi;</citetitle>, section
            <citetitle>Mass Installation and Deployment with &ay;</citetitle>.
          </para>
          <para>
            For all machines that need the &geo; clustering extension, you currently need
            to install the packages for &geo; clusters manually. &ay;
            support for &hageo; is not yet available.
          </para>
        </listitem>
      </itemizedlist>
    </important>
  </sect1>
 <xi:include href="geo_resources_i.xml"/>
 <xi:include href="common_legal.xml"/>
</article>
