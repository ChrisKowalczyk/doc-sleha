<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_config_hawk2.xml" xml:id="cha.conf.hawk2" version="5.0">
 <title>Hawk2を使用したクラスタリソースの設定と管理</title>
 <info>
  <abstract>
   <para> クラスタリソースを設定および管理する場合、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>では、HA Web Konsole (Hawk)、またはcrmシェル(crmsh)コマンドラインユーティリティのいずれかを使用します。 </para>
   <para> HawkのWebベースのユーザインタフェースを使用すれば、Linux以外のマシンから、Linuxクラスタを監視し、管理することができます。さらにこれは、ご使用のシステムが最小限のグラフィカルユーザインタフェースしか提供していない場合に最適なソリューションです。 </para>

   
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>編集</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>
 <note>
  <title>Hawkのバージョン</title>
  <para><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1には、次の2つのバージョンのHawkが同時に付属しています。</para>
  <itemizedlist>
   <listitem>
    <para>RPMパッケージ<systemitem class="resource">hawk</systemitem>に付属するHawkバージョン<literal>1</literal>。このバージョンのHawkのマニュアルについては、<xref linkend="cha.ha.config.hawk"/>を参照してください。</para>
   </listitem>
   <listitem>
    <para>RPMパッケージ<systemitem class="resource">hawk2</systemitem>に付属するHawkバージョン<literal>2</literal>。ここでは、このバージョンのHawkを取り上げています。</para>
   </listitem>
  </itemizedlist>
 </note>

 <sect1 xml:id="sec.conf.hawk2.req">
  <title>Hawk2の要件</title>
  <para>Hawkにログインするには、次の要件を満たす必要があります。</para>

  <itemizedlist>
   <listitem>
    <para>Hawk2で接続するすべてのクラスタノードに<systemitem class="resource">hawk2</systemitem>パッケージをインストールする必要があります。</para>
   </listitem>
   <listitem>
    <para> Hawk2を使用してクラスタノードにアクセスするマシンに必要なものは、JavaScriptとクッキーを有効にして接続を確立できる(グラフィカル) Webブラウザだけです。 </para>
   </listitem>
   <listitem>
    <para> Hawkを使用するには、このWebインタフェースで接続するノード上で、それぞれのWebサービスが開始されている必要があります。詳細については、<xref linkend="pro.ha.hawk2.service"/>を参照してください。</para>
    <para> <systemitem class="resource">ha-cluster-bootstrap</systemitem>パッケージからスクリプトを使用してクラスタをセットアップした場合、Hawk2サービスはすでに有効になっています。 </para>
   </listitem>
   <listitem>
    <para> Hawkユーザは<systemitem class="groupname">haclient</systemitem>グループのメンバーである必要があります。インストール時に<systemitem class="username">hacluster</systemitem>という名前のLinuxユーザが作成されますが、このユーザが<systemitem class="groupname">haclient</systemitem>グループに追加されます。セットアップ用に<command>ha-cluster-init</command>スクリプトを使用している場合は、<systemitem class="username">hacluster</systemitem>ユーザに対してデフォルトパスワードが設定されます。 </para>
    <para> Hawk2を開始する前に、<systemitem>hacluster</systemitem>ユーザのパスワードを設定するか変更してください。または、<systemitem class="groupname">haclient</systemitem>グループのメンバーである新しいユーザを作成してください。 </para>
    <para> Hawk2を使用して接続する各ノードでこれを実行します。 </para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro.ha.hawk2.service">
   <title>Hawkサービスの開始</title>
   <step>
    <para> 接続先にするノードで、シェルを開き、<systemitem class="username">root</systemitem>としてログインします。 </para>
   </step>
   <step>
    <para> 次のように入力して、サービスのステータスをチェックします。 </para>
    <screen><prompt role="root">root # </prompt><command>systemctl</command> status hawk</screen>
   </step>
   <step>
    <para> サービスが実行されていない場合は、次のコマンドでサービスを開始します。 </para>
    <screen><prompt role="root">root # </prompt><command>systemctl</command> start hawk</screen>
    <para> ブート時にHawkを自動的にブートしたい場合は、次のコマンドを実行します。 </para>
    <screen><prompt role="root">root # </prompt><command>systemctl</command> enable hawk</screen>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.conf.hawk2.login">
  <title>ログイン</title>
  <para> Hawk2 Webインタフェースは、HTTPSプロトコルとポート<literal>7630</literal>を使用します。 </para>
  
  <note>
   <title>仮想IPによるHawk2へのアクセス</title>
   <para>通常接続するクラスタノードがダウンしている場合でもHawk2にアクセスできるようにするには、クラスタリソースとしてのHawk2に仮想IPアドレス(<literal>IPaddr</literal>または<literal>IPaddr2</literal>)を設定します。そのための特別な設定は不要です。</para>
  </note>
  <procedure xml:id="pro.ha.hawk2.login">
   <title>Hawk2 Webインタフェースへのログイン</title>

   <step>
    <para> 任意のコンピュータで、Webブラウザを起動し、JavaScriptとクッキーが有効なことを確認します。 </para>
   </step>
   <step>
    <para> URLとして、Hawk Webサービスを実行するクラスタノードのIPアドレスまたはホスト名を入力します。または、クラスタオペレータが設定した<literal>IPaddr(2)</literal>リソースのアドレスを入力します。 </para>
    <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    <note>
     <title>証明書の警告</title>
     <para> 初めてURLにアクセスしようとするときに証明書の警告が表示される場合は、自己署名証明書が使用されています。自己署名証明書は、デフォルトでは信頼されません。 </para>
     <para> 証明書を検証するための詳細情報については、クラスタのオペレータに問い合わせてください。 </para>
     <para> 続行するには、ブラウザに例外を追加して警告をバイパスします。 </para>
     <para> 自己署名証明書を公式認証局によって署名された証明書で置き換える方法の詳細については、<xref linkend="vle.ha.hawk.certificate"/>を参照してください。 </para>
    </note>
   </step>
   <step>
    <para> Hawk2ログイン画面で、<systemitem class="username">hacluster</systemitem>ユーザ(または、<systemitem class="groupname">haclient</systemitem>グループのメンバーである他の任意のユーザ)の<guimenu>ユーザ名</guimenu>と<guimenu>パスワード</guimenu>を入力します。 </para>
   </step>
   <step>
    <para> <guimenu>ログイン</guimenu>をクリックします。 </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.conf.hawk2.overview">
  <title>Hawkの概要: 主な構成要素</title>

  <para>Hawk2にログインすると、左側にはナビゲーションバー、右側には複数のリンクが含まれる最上位の行が表示されます。</para>


  <note>
   <title>Hawk2で利用できる機能</title>
   <para> デフォルトでは、<systemitem class="username">root</systemitem>または<systemitem class="username">hacluster</systemitem>としてログインしたユーザは、すべてのクラスタ設定作業への、完全な読み込み/書き込みのアクセス権を持ちます。ただし、<xref linkend="cha.ha.acl" xrefstyle="select:title"/>(ACL)を使用すれば、より詳細なアクセス権限を定義することができます。 </para>
   <para> CRMでACLが有効になっている場合、Hawk2で利用できる機能は、ユーザ役割と割り当てられたアクセスパーミッションごとに異なります。加えて、Hawk2の次の機能は、ユーザ<systemitem class="username">hacluster</systemitem>だけが使用できます: <guimenu>履歴エクスプローラー</guimenu>の使用。</para>
  </note>


  <sect2 xml:id="sec.conf.hawk2.overview.leftnav">
   <title>左のナビゲーションバー</title>

   <variablelist>
    <varlistentry>
     <term><guimenu>管理</guimenu></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>Status (状態)</guimenu>: クラスタの現在の状態の概要が表示されます(crmshの<command>crm status</command>と同様です)。詳細については、<xref linkend="sec.conf.hawk2.manage.monitor.status"/>を参照してください。この画面はほぼリアルタイムで更新され、ノードまたはリソースの状態に変化があった場合、ほとんど瞬時に反映されます。</para>
       </listitem>
       <listitem>
        <para>
         <guimenu>Dashboard (ダッシュボード)</guimenu>: 複数のクラスタを監視できます(Geoクラスタがセットアップされている場合は、別のサイトにあるクラスタも監視できます)。詳細については、<xref linkend="sec.conf.hawk2.manage.monitor.dash"/>を参照してください。この画面はほぼリアルタイムで更新され、ノードまたはリソースの状態に変化があった場合、ほとんど瞬時に反映されます。</para>
       </listitem>
       
       <listitem>
        <para>
         <guimenu>履歴</guimenu>: <guimenu>履歴エクスプローラー</guimenu>を開いてクラスタレポートを生成できます。</para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>環境設定</guimenu></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>Add a resource (リソースの追加)</guimenu>: リソース設定画面を開きます。詳細については、<xref linkend="sec.conf.hawk2.rsc"/>を参照してください。 </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>Add a constraint (制約の追加)</guimenu>: 制約設定画面を開きます。詳細については、<xref linkend="sec.conf.hawk2.cons"/>を参照してください。</para>
       </listitem>
       <listitem>
        <para>
         <guimenu>Choose a wizard (ウィザードの選択)</guimenu>: さまざまなウィザードを選択できます。これにより、DRBDブロックデバイスなどの特定のワークロード用のリソースをウィザードに従って作成できます。詳細については、<xref linkend="sec.conf.hawk2.rsc.wizard"/>を参照してください。</para>
       </listitem>
       <listitem>
        <para>
         <guimenu>Edit (編集)</guimenu>: ノードの名前と属性、リソース、および制約を編集できます。</para>
       </listitem> 
       <listitem>
        <para><guimenu>Configuration (設定)</guimenu>: <guimenu>Cluster Configuration (クラスタ設定)</guimenu>画面を開いて、グローバルクラスタオプションを変更できます。詳細については、<xref linkend="sec.conf.hawk2.cluster.config"/>を参照してください。</para>
       </listitem>
       <listitem>
        <para><guimenu>Command Log (コマンドログ)</guimenu>: Hawk2によって最近実行されたcrmshコマンドのリストを表示します。 </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>アクセス制御</guimenu></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>Roles (役割)</guimenu>: アクセス制御リスト(CIBへのアクセス権を記述した一連のルール)に対して役割を作成できる画面を開きます。 </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>Targets (ターゲット)</guimenu>: アクセス制御リストのターゲット(システムユーザ)を作成して、そのターゲットに役割を割り当てることができる画面を開きます。 </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.overview.toprow">
   <title>最上位のナビゲーション</title>
   <para>Hawkの最上位の行には、次のエントリが表示されます。</para>
   <itemizedlist>
    <listitem>
     <para><guimenu>Cluster Details (クラスタの詳細)</guimenu>: クリックすると、ほぼリアルタイムで更新される詳細情報のリストが開きます。エポックおよび状態に何らかの変化があった場合、ほとんど瞬時に反映されます。 </para></listitem>
    <listitem>
     <para><guimenu>Simulator (シミュレータ)</guimenu>: クリックすると、シミュレータモードの有効/無効を切り替えることができます。  </para>
    </listitem>
    <listitem>
     <para><guimenu>Profile (プロファイル)</guimenu>: クリックすると、Hawk2の言語設定を変更できます。</para>
    </listitem>
    <listitem>
     <para><guimenu>ヘルプ</guimenu>: クリックすると、Hawk2で接続しているノードにインストールされている、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>のHTMLおよびPDF版のマニュアルにアクセスできます。</para>
    </listitem>
    <listitem>
     <para><guimenu>Logout (ログアウト)</guimenu>: クリックするとログアウトします。</para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.conf.hawk2.cluster.config">
  <title>グローバルクラスタオプションの設定</title>
  <para> グローバルクラスタオプションは、一定の状況下でのクラスタの動作を制御します。これらは、セットにグループ化され、Hawk、crmshなどのクラスタ管理ツールで表示し、変更することができます。事前に定義されている値は、通常は、そのまま保持できます。ただし、クラスタの主要機能を正しく機能させるには、クラスタの基本的なセットアップ後に、次のパラメータを調整する必要があります。 </para>
  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="sec.ha.config.basics.global.quorum" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec.ha.config.basics.global.stonith" xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro.conf.hawk2.global">
   <title>グローバルクラスタオプションを変更する</title>
   <step>
    <para>Hawk2にログインします。</para>
    <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>左のナビゲーションバーで、<menuchoice> <guimenu>管理</guimenu> <guimenu>Configuration (設定)</guimenu> </menuchoice>の順に選択します。</para>
    <para><guimenu>Cluster Configuration (クラスタ設定)</guimenu>画面が開きます。グローバルクラスタオプションとその現在の値が表示されます。 </para>
    <para>画面の右側にパラメータの簡単な説明を表示するには、マウスポインタをパラメータに合わせます。 </para>
    <figure pgwide="0">
     <title>Hawk - クラスタ設定</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk2-cluster-config.png" width="100%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk2-cluster-config.png" width="100%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para> <guimenu>no-quorum-policy</guimenu>および<guimenu>stonith-enabled</guimenu>の値を確認し、必要に応じて調整します。 </para>
    <substeps performance="required">
     <step>
      <para> <guimenu>no-quorum-policy</guimenu>を適切な値に設定します。2ノードクラスタの場合、<literal>ignore</literal>に設定する必要があります。詳細については、<xref linkend="sec.ha.config.basics.global.quorum"/>を参照してください。
      </para>
     </step>
     <step>
      <para> 何らかの理由でフェンシングを無効にする必要がある場合は、<guimenu>stonith-enabled</guimenu>を<literal>no</literal>に設定します。通常のクラスタ操作には、STONITHデバイスの使用が必要なので、このグローバルオプションは、デフォルトで<literal>true</literal>に設定されています。デフォルト値では、クラスタは、STONITHリソースが定義されていない場合にはリソースの開始を拒否します。 </para>
      <important>
       <title>STONITHがない場合はサポートなし</title>
       <para> STONITHがないクラスタはサポートされません。 </para>
      </important>
     </step>
     <step>
      <para> クラスタ設定からパラメータを削除するには、パラメータの横のマイナスアイコンをクリックします。パラメータを削除すると、クラスタはそのパラメータがデフォルト値に設定されている場合と同様に動作します。 </para>
     </step>
     <step>
      <para> クラスタ設定に新しいパラメータを追加するには、ドロップダウンボックスからパラメータを1つ選択し、プラスアイコンをクリックします。 </para>
     </step>
    </substeps>
   </step>
   <step>
    <para> <guimenu>リソースのデフォルト</guimenu>または<guimenu>操作のデフォルト</guimenu>を変更する必要がある場合は、次のような処理を実行します。 </para>
    <substeps performance="required">
     <step>
      <para> 値を調整するには、ドロップダウンボックスから別の値を選択するか、値を直接編集します。 </para>
     </step>
     <step>
      <para> 新しいリソースのデフォルトまたは操作のデフォルトを追加するには、空のドロップダウンリストから1つ選択し、プラスアイコンをクリックして値を入力します。デフォルト値が存在する場合は、Hawk2から自動的に提示されます。 </para>
     </step>
     <step>
      <para> パラメータを削除するには、その横のマイナスアイコンをクリックします。<guimenu>リソースのデフォルト</guimenu>と<guimenu>操作のデフォルト</guimenu>に値が指定されていない場合、クラスタは<xref linkend="sec.ha.config.basics.meta.attr"/>および<xref linkend="sec.ha.config.basics.operations"/>にドキュメントされているデフォルト値を使用します。 </para>
     </step>
    </substeps>
   </step>
   <step>
    <para> 変更内容を確認します。 </para>
   </step>
  </procedure>
 </sect1>
 <xi:include href="ha_hawk2_rsc_i.xml"/>
 <xi:include href="ha_hawk2_cons_i.xml"/>
 <xi:include href="ha_hawk2_manage_i.xml"/>
</chapter>
