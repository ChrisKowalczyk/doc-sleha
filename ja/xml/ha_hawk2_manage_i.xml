<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_hawk2_manage_i.xml" version="5.0" xml:id="sec.conf.hawk2.manage">
  
  <title>クラスタリソースの管理</title>
  
    <info>
   <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
    <dm:maintainer/>
    <dm:status>編集</dm:status>
    <dm:deadline/>
    <dm:priority/>
    <dm:translation>yes</dm:translation>
    <dm:languages/>
    <dm:release/>
    <dm:repository/>
   </dm:docmanager>
    </info>
 
  <para> Hawkでは、クラスタリソースを設定することに加えて、<guimenu>Status (状態)</guimenu>画面で既存のリソースを管理することができます。この画面の概要については、<xref linkend="sec.conf.hawk2.manage.monitor.status"/>を参照してください。</para>
  <sect2 xml:id="sec.conf.hawk2.manage.start">
   <title>リソースの開始</title>
   <para> クラスタリソースは、起動する前に、正しく設定されているようにします。たとえば、Apacheサーバをクラスタリソースとして使用する場合は、まず、Apacheサーバをセットアップし、Apacheの環境設定を完了してから、クラスタで個々のリソースを起動します。 </para>
   <note>
    <title>クラスタによって管理されるサービスには介入しないでください。</title>
    <para> High Availability Extensionでリソースを管理しているときに、リソースを他の方法(クラスタ外で、たとえば、手動、ブート、再起動など)で開始したり、停止したりしてはなりません。High Availability Extensionソフトウェアが、すべてのサービスの開始または停止アクションを実行します。 </para>
    <para> ただし、サービスが適切に構成されているか確認したい場合は手動で開始しますが、High Availabilityが起動する前に停止してください。 </para>
    <para> 現在クラスタで管理されているリソースへの介入については、まず、リソースを<literal>maintenance mode</literal>に設定します。<remark>taroth 2015-12-04: ToDo: add
      for next revision: krig - how does that work with hawk2? does it work already? 
      I searched in the Operations column for a resource but could not find anything there...
      krig 2015-12-08: Ah! That's the "Unmanage" operation on resources.</remark>
    </para>
   </note>
   <para> Hawkでリソースを作成するときには、<literal>target-role</literal>メタ属性でその初期状態を設定することができます。その値を<literal>stopped</literal>に設定した場合、リソースは、作成後、自動的に開始することはありません。 </para>
   <procedure xml:id="pro.hawk2.rsc.start">
    <title>新しいリソースを起動する</title>
    <step>
     <para>Hawk2にログインします。</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 左のナビゲーションバーで、<guimenu>Status (状態)</guimenu>を選択します。<guimenu>Resources (リソース)</guimenu>のリストには<guimenu>Status (状態)</guimenu>も表示されます。 </para>
    </step>
    <step>
     <para> 開始するリソースを選択し、その<guimenu>Operations (操作)</guimenu>列で<guimenu>Start (開始)</guimenu>アイコンをクリックします。継続するには、表示されるメッセージに対して確認します。 </para>
     <para>リソースが開始すると、Hawkはすぐにリソースの<guimenu>状態</guimenu>を緑に変え、それがどのノードで実行されているかを表示します。 </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec.conf.hawk2.manage.cleanup">
   <title>リソースのクリーンアップ</title>
   <para> リソースは、失敗した場合は自動的に再起動しますが、失敗のたびにリソースの失敗回数が増加します。 </para>
   <para> リソースに対して<literal>migration-threshold</literal>が設定されていた場合、失敗回数が移行しきい値に達すると、そのリソースはそのノードでは実行されなくなります。 </para>
   <para> リソースの失敗回数は、(リソースに<literal>failure-timeout</literal>オプションを設定することにより)自動的にリセットするか、または次に示すように手動でリセットできます。 </para>
   <procedure xml:id="pro.hawk2.clean">
    <title>リソースをクリーンアップする</title>
    <step>
     <para>Hawk2にログインします。</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 左のナビゲーションバーで、<guimenu>Status (状態)</guimenu>を選択します。<guimenu>Resources (リソース)</guimenu>のリストには<guimenu>Status (状態)</guimenu>も表示されます。 </para>
    </step>
    <step>
     <para> クリーンアップするリソースに移動します。<guimenu>Operations (操作)</guimenu>列で、下矢印ボタンをクリックして<guimenu>Cleanup (クリーンアップ)</guimenu>を選択します。継続するには、表示されるメッセージに対して確認します。 </para>
     <para>これにより、コマンド<command>crm resource cleanup</command>が実行され、すべてのノードでリソースがクリーンアップされます。 </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec.conf.hawk2.manage.remove">
   <title>クラスタリソースの削除</title>
   <para> リソースをクラスタから削除する必要がある場合は、次の手順に従って、設定エラーが発生しないようにします。 </para>
   <procedure xml:id="pro.hawk2.rsc.rm">
    <title>クラスタリソースの削除</title>
    <step>
     <para> <xref linkend="pro.hawk2.clean"/>の説明に従って、すべてのノードでリソースをクリーンアップします。
     </para>
    </step>
    <step>
     <para>リソースを停止します。</para>
     <substeps>
      <step>
       <para> 左のナビゲーションバーで、<guimenu>Status (状態)</guimenu>を選択します。<guimenu>Resources (リソース)</guimenu>のリストには<guimenu>Status (状態)</guimenu>も表示されます。 </para>
      </step>
      <step>
       <para><guimenu>Operations (操作)</guimenu>列で、リソースの横にある<guimenu>Stop (停止)</guimenu>ボタンをクリックします。 </para>
      </step>
      <step>
       <para>継続するには、表示されるメッセージに対して確認します。</para>
       <para>リソースが停止すると、すぐに<guimenu>Status (状態)</guimenu>列に変更が反映されます。</para>
      </step>
     </substeps>
    </step>
    <step>
     <para>リソースを削除します。</para>
     <substeps>
      <step>
       <para> 左のナビゲーションバーで、<guimenu>Edit (編集)</guimenu>を選択します。 </para>
      </step>
      <step>
       <para><guimenu>Resources (リソース)</guimenu>のリストで、それぞれのリソースに移動します。<guimenu>Operations (操作)</guimenu>列で、リソースの横にある<guimenu>Delete (削除)</guimenu>アイコンをクリックします。</para>
      </step>
      <step>
       <para>継続するには、表示されるメッセージに対して確認します。</para>
      </step>
     </substeps>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.manage.migrate">
   <title>クラスタリソースの移行</title>
   <para> <xref linkend="sec.conf.hawk2.failover"/>で説明したように、ソフトウェアまたはハードウェアの障害時には、クラスタは定義可能な特定のパラメータ(たとえばマイグレーションしきい値やリソースの固着性など)に従って、リソースを自動的にフェールオーバー(マイグレート)させます。クラスタ内の別のノードにリソースを手動で移行させることもできます。または、リソースを現在のノードから出すかはユーザが判断し、どこに移動するかはクラスタに判断させます。 </para>
   <procedure xml:id="pro.hawk2.rsc.migrate">
    <title>リソースを手動で移行する</title>
    <step>
     <para>Hawk2にログインします。</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 左のナビゲーションバーで、<guimenu>Status (状態)</guimenu>を選択します。<guimenu>Resources (リソース)</guimenu>のリストには<guimenu>Status (状態)</guimenu>も表示されます。 </para>
    </step>
    <step>
     <para><guimenu>Resources (リソース)</guimenu>のリストで、それぞれのリソースを選択します。</para>
    </step>
    <step>
     <para><remark>taroth 2015-12-07: krig, is there any way to select which node to migrate the
       resource to? krig: also, Hawk1 has two options: "Move" (lets you select where to move the rsc
       to and creates a location constraint with an INFINITY score for the destination node) and
       "Away from current node" (creates a location constraint with a -INFINITY score for the
       current node) - is there anything like this with Hawk2? - taroth 2015-12-08: on behalf of
       krig, filed https://bugzilla.suse.com/show_bug.cgi?id=958386 for this </remark><guimenu>Operations (操作)</guimenu>列で、下矢印ボタンをクリックして<guimenu>Migrate (移行)</guimenu>を選択します。継続するには、表示されるメッセージに対して確認します。</para>
    </step>
   </procedure>
   <para> リソースを再び元に戻すには、次の手順に従います。 </para>
   <procedure xml:id="pro.hawk2.rsc.migrate.back">
    <title>リソースの移行解除</title>

    <step>
     <para>Hawk2にログインします。</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 左のナビゲーションバーで、<guimenu>Status (状態)</guimenu>を選択します。<guimenu>Resources (リソース)</guimenu>のリストには<guimenu>Status (状態)</guimenu>も表示されます。 </para>
    </step>
    <step>
     <para><guimenu>Resources (リソース)</guimenu>のリストで、それぞれのリソースに移動します。</para>
    </step>
    <step>
     <para><guimenu>Operations (操作)</guimenu>列で、下矢印ボタンをクリックして<guimenu>Unmigrate (移行解除)</guimenu>を選択します。継続するには、表示されるメッセージに対して確認します。</para>
     <para>
        これによって、<command>crm_resource&#xa0;</command><option>-U</option>コマンドが使用されます。リソースは元の場所に戻ることができます。あるいは現在の場所に残ることもあります(リソースの固着性によって)。</para>
    </step>
   </procedure>

   <para> 詳細については、<link xlink:href="http://www.clusterlabs.org/doc/"/>から入手できる『<citetitle>Pacemaker Explained</citetitle>』を参照してください。特に、「<citetitle>Resource Migration</citetitle>」のセクションを参照してください。 </para>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.manage.monitor.status">
   <title>クラスタの監視</title>
   <para>ログインすると、Hawkにはデフォルトで<guimenu>Status (状態)</guimenu>が表示されます。右上隅のアイコンに、クラスタの状態の概要が表示されます。詳細情報を参照する場合は、次のカテゴリを確認します。</para>
   <variablelist>
    <varlistentry>
     <term>［エラー］</term>
     <listitem>
      <para>エラーが発生した場合にのみ表示されます。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>リソース</term>
     <listitem>
      <para>設定されているリソースが表示されます。その<guimenu>状態</guimenu>、<guimenu>名前</guimenu> (ID)、場所(リソースが実行されているノード)、リソースエージェントの<guimenu>タイプ</guimenu>が含まれます。<guimenu>Operations (操作)</guimenu>列から、アクションのトリガ、リソースの編集、またはリソースの詳細(<guimenu>メタ属性</guimenu>, <guimenu>Operations (操作)</guimenu>、<guimenu>Instances (インスタンス)</guimenu>など)の表示を行うことができます。トリガできるアクションには、<literal>start</literal>/<literal>stop</literal>、<literal>manage</literal>/<literal>unmanage</literal>、<literal>migrate</literal>/<literal>unmigrate</literal>、または<literal>cleanup</literal>があります。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>ノード</term>
     <listitem>
      <para>ログイン先のクラスタサイトに属するノードが表示されます。ノードの<guimenu>状態</guimenu>および<guimenu>名前</guimenu>が含まれます。<guimenu>Maintenance (保守)</guimenu>および<guimenu>Standby (スタンバイ)</guimenu>列で、<literal>maintenance</literal>または<literal>standby</literal>フラグを設定または解除できます。<guimenu>Operations (操作)</guimenu>列で、詳細情報を参照できます。たとえば、それぞれのノードに<literal>utilization</literal>、<literal>standby</literal>、または<literal>maintenance</literal>のどの属性が設定されているかを参照できます。 </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <figure pgwide="0">
    <title>Hawk2 - クラスタの状態</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="hawk2-cluster-status-main.png" width="100%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="hawk2-cluster-status-main.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.manage.monitor.dash">
   <title>複数のクラスタの監視</title>
   <para> <guimenu>Dashboard (ダッシュボード)</guimenu>画面はサーバ側に保存されており、クラスタノード間で同期されます(クラスタノード間でのパスワード不要のSSHアクセスが設定されている場合)。詳細については、<xref linkend="sec.crmreport.nonroot.ssh"/>を参照してください。ただし、Hawk2を実行するマシンは、その目的のためにクラスタの一部である必要はなく、別個の無関係のシステムで構いません。 </para>
   <procedure xml:id="pro.conf.hawk2.dashboard">
    <title>Hawk2による複数クラスタの監視</title>
    <para>Hawkで複数のクラスタを監視するには、一般的な<xref linkend="sec.conf.hawk2.req" xrefstyle="select:title"/>に加え、次の前提条件も満たす必要があります。</para>
    <itemizedlist>
     <title>前提条件</title>
     <listitem>
      <para> Hawkの<guimenu>Dashboard</guimenu>で監視するすべてのクラスタでは、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">12 SP1を実行している必要があります。</phrase></phrase>それより前のバージョンの<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>を実行しているクラスタは監視できません。 </para>
     </listitem>
     <listitem>
      <para>すべてのクラスタノードにあるHawk2の自己署名証明書を独自の証明書(または公式認証局によって署名された証明書)で置き換えていない場合は、<emphasis></emphasis>「すべての」クラスタの<emphasis></emphasis>「すべての」ノードで、少なくとも1回はHawkにログインします。証明書を検証します(または、ブラウザで例外を追加して警告をスキップします)。 </para>
     </listitem>
    </itemizedlist>
    <step>
     <para>Hawk2にログインします。</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para>左のナビゲーションバーから、<guimenu>Dashboard (ダッシュボード)</guimenu>を選択します。 </para>
    </step>
    <step>
     <para>複数のクラスタのダッシュボードを追加するため、<guimenu>Add Cluster (クラスタの追加)</guimenu>をクリックします。</para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="hawk2-dashboard-add-cluster.png" width="100%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="hawk2-dashboard-add-cluster.png" width="100%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
     <substeps>
      <step>
       <para> <guimenu>Dashboard (ダッシュボード)</guimenu>でクラスタを識別するためのカスタムクラスタ名を<guimenu>クラスタ名</guimenu>に入力します。 </para>
      </step>
      <step>
       <para>クラスタ内のノードのホスト名を<guimenu>Hostname of a node in the cluster (クラスタ内のノードのホスト名)</guimenu>に入力します。</para>
      </step>
      <step>
       <para>Hawk2の更新間隔、接続先のポート、HTTPSを使用するかどうか(デフォルトでは使用)などの他のオプションを指定するには、<guimenu>Advanced (詳細設定)</guimenu>をクリックして詳細情報を入力します。 </para>
      </step>
      <step>
       <para><guimenu>Add (追加)</guimenu>をクリックして、変更を確認します。</para>

      </step>
      <step>
       <para> ダッシュボードにクラスタをさらに追加するには、もう一度<guimenu>Add Cluster (クラスタの追加)</guimenu>をクリックして、次のクラスタの詳細を入力します。 </para>
       <figure>
        <title>Hawk2 - ダッシュボード</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="hawk2-dashboard-multiple-clusters.png" width="100%" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="hawk2-dashboard-multiple-clusters.png" width="100%" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
     </substeps>
    </step>
    <step>
     <para> ダッシュボードからクラスタを削除するには、クラスタの名前の横にある<literal>x</literal>アイコンをクリックします。 </para>
    </step>
    <step>
     <para> クラスタの詳細を表示するには、パスワードを入力して、<guimenu>Connect (接続)</guimenu>をクリックします。 </para>
     <para> それぞれのノード、リソース、およびチケットの状態と共にサマリが表示されます。クラスタ名をクリックすると、クラスタの<guimenu>Status (状態)</guimenu>画面が表示されます。ここから、通常の方法でクラスタを管理できます。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
