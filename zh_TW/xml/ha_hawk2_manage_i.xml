<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_hawk2_manage_i.xml" version="5.0" xml:id="sec.conf.hawk2.manage">
  
  <title>管理叢集資源</title>
  
    <info>
   <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
    <dm:maintainer/>
    <dm:status>編輯</dm:status>
    <dm:deadline/>
    <dm:priority/>
    <dm:translation>yes</dm:translation>
    <dm:languages/>
    <dm:release/>
    <dm:repository/>
   </dm:docmanager>
    </info>
 
  <para> 除了設定叢集資源外，Hawk 還可讓您透過<guimenu>狀態</guimenu>螢幕管理現存資源。若要瞭解螢幕概觀，請參見<xref linkend="sec.conf.hawk2.manage.monitor.status"/>。</para>
  <sect2 xml:id="sec.conf.hawk2.manage.start">
   <title>啟動資源</title>
   <para> 啟動叢集資源之前，請先確定該資源已正確設定。例如，如果想要使用 Apache 伺服器做為叢集資源，請先設定 Apache 伺服器。完成 Apache 組態設定後，再在叢集中啟動相應的資源。 </para>
   <note>
    <title>不要對叢集管理的服務執行任何操作</title>
    <para> 當您正透過 High Availability Extension 管理某個資源時，就不能再啟動或停止該資源 (例如，不能在叢集之外手動啟動或停止，或者在開機或重新開機時啟動或停止)。High Availability Extension 軟體負責所有服務的啟動或停止動作。 </para>
    <para> 不過，如果您要檢查服務是否正確設定，請手動將其啟動，但務必在 High Availability 接管之前將它再次停止。 </para>
    <para> 若要對目前由叢集管理的資源進行干預，請先將資源設定為<literal>維護模式</literal>。<remark>taroth 2015-12-04: ToDo: add
      for next revision: krig - how does that work with hawk2? does it work already? 
      I searched in the Operations column for a resource but could not find anything there...
      krig 2015-12-08: Ah! That's the "Unmanage" operation on resources.</remark>
    </para>
   </note>
   <para> 透過 Hawk 建立資源時，您可以使用 <literal>target-role</literal> 中繼屬性設定該資源的初始狀態。如果將其值設定為 <literal>stopped</literal>，則資源建立後不會自動啟動。 </para>
   <procedure xml:id="pro.hawk2.rsc.start">
    <title>啟動新資源</title>
    <step>
     <para>登入 Hawk2︰</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 在左側導覽列中選取<guimenu>狀態</guimenu>。<guimenu>資源</guimenu>清單還會顯示<guimenu>狀態</guimenu>。 </para>
    </step>
    <step>
     <para> 選取要啟動的資源，在其<guimenu>操作</guimenu>欄中按一下<guimenu>啟動</guimenu>圖示。若要繼續，請確認顯示的訊息。 </para>
     <para>資源一旦啟動，Hawk 會將該資源的<guimenu>狀態</guimenu>變為綠色，並顯示目前執行該資源的節點。 </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec.conf.hawk2.manage.cleanup">
   <title>清理資源</title>
   <para> 如果資源失敗，系統會自動將其重新啟動，但每次失敗都會增加該資源的 failcount。 </para>
   <para> 如果為資源設定了 <literal>migration-threshold</literal>，則當失敗次數達到移轉限定值時，節點將不再執行該資源。 </para>
   <para> 資源的 failcount 可自動重設 (若為資源設定 <literal>failure-timeout</literal> 選項)，也可按如下方式手動重設。 </para>
   <procedure xml:id="pro.hawk2.clean">
    <title>清理資源</title>
    <step>
     <para>登入 Hawk2︰</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 在左側導覽列中選取<guimenu>狀態</guimenu>。<guimenu>資源</guimenu>清單還會顯示<guimenu>狀態</guimenu>。 </para>
    </step>
    <step>
     <para> 轉到資源，進行清理。在<guimenu>操作</guimenu>欄中按一下向下箭頭按鈕，然後選取<guimenu>清理</guimenu>。若要繼續，請確認顯示的訊息。 </para>
     <para>系統會執行指令 <command>crm resource cleanup</command> 並清理所有節點上的資源。 </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec.conf.hawk2.manage.remove">
   <title>移除叢集資源</title>
   <para> 如果需要從叢集移除資源，請按照下面的程序操作，以免出現組態錯誤： </para>
   <procedure xml:id="pro.hawk2.rsc.rm">
    <title>移除叢集資源</title>
    <step>
     <para> 依照<xref linkend="pro.hawk2.clean"/> 中的說明在所有節點上清理該資源。
     </para>
    </step>
    <step>
     <para>停止資源：</para>
     <substeps>
      <step>
       <para> 在左側導覽列中選取<guimenu>狀態</guimenu>。<guimenu>資源</guimenu>清單還會顯示<guimenu>狀態</guimenu>。 </para>
      </step>
      <step>
       <para>在<guimenu>操作</guimenu>欄中按一下資源旁邊的<guimenu>停止</guimenu>按鈕。 </para>
      </step>
      <step>
       <para>若要繼續，請確認顯示的訊息。</para>
       <para>一旦資源停止，這個變化會立即體現在<guimenu>狀態</guimenu>欄中。</para>
      </step>
     </substeps>
    </step>
    <step>
     <para>刪除資源︰</para>
     <substeps>
      <step>
       <para> 在左側導覽列中選取<guimenu>編輯</guimenu>。 </para>
      </step>
      <step>
       <para>在<guimenu>資源</guimenu>清單中前往相應的資源。在<guimenu>操作</guimenu>欄中按一下資源旁邊的<guimenu>刪除</guimenu>按鈕。</para>
      </step>
      <step>
       <para>若要繼續，請確認顯示的訊息。</para>
      </step>
     </substeps>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.manage.migrate">
   <title>移轉叢集資源</title>
   <para> 如<xref linkend="sec.conf.hawk2.failover"/> 所述，當軟體或硬體發生故障時，叢集會自動對資源進行容錯移轉 (移轉)，具體情況視您可以定義的特定參數 (例如移轉限定值或資源粘性) 而定。除此之外，您也可以手動將資源移轉至叢集中的其他節點。或者，您決定將資源移出目前節點，然後讓叢集決定移入的目標位置。 </para>
   <procedure xml:id="pro.hawk2.rsc.migrate">
    <title>手動移轉資源</title>
    <step>
     <para>登入 Hawk2︰</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 在左側導覽列中選取<guimenu>狀態</guimenu>。<guimenu>資源</guimenu>清單還會顯示<guimenu>狀態</guimenu>。 </para>
    </step>
    <step>
     <para>在<guimenu>資源</guimenu>清單中選取相應的資源。</para>
    </step>
    <step>
     <para><remark>taroth 2015-12-07: krig, is there any way to select which node to migrate the
       resource to? krig: also, Hawk1 has two options: "Move" (lets you select where to move the rsc
       to and creates a location constraint with an INFINITY score for the destination node) and
       "Away from current node" (creates a location constraint with a -INFINITY score for the
       current node) - is there anything like this with Hawk2? - taroth 2015-12-08: on behalf of
       krig, filed https://bugzilla.suse.com/show_bug.cgi?id=958386 for this </remark>在<guimenu>操作</guimenu>欄中按一下向下箭頭按鈕，然後選取<guimenu>移轉</guimenu>。若要繼續，請確認顯示的訊息。</para>
    </step>
   </procedure>
   <para> 若要讓資源回到原來的狀態，請執行下列步驟： </para>
   <procedure xml:id="pro.hawk2.rsc.migrate.back">
    <title>取消移轉資源</title>

    <step>
     <para>登入 Hawk2︰</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 在左側導覽列中選取<guimenu>狀態</guimenu>。<guimenu>資源</guimenu>清單還會顯示<guimenu>狀態</guimenu>。 </para>
    </step>
    <step>
     <para>在<guimenu>資源</guimenu>清單中前往相應的資源。</para>
    </step>
    <step>
     <para>在<guimenu>操作</guimenu>欄中按一下向下箭頭按鈕，然後選取<guimenu>取消移轉</guimenu>。若要繼續，請確認顯示的訊息。</para>
     <para>
        此過程會使用 <command>crm_resource&#xa0;</command><option>-U</option> 指令。資源可以移回其原始位置，也可以保留在目前的位置 (具體取決於資源粘性)。</para>
    </step>
   </procedure>

   <para> 如需詳細資訊，請參閱 <link xlink:href="http://www.clusterlabs.org/doc/"/> 上的<citetitle>《Pacemaker Explained》</citetitle>(Pacemaker 描述)。可參閱其中的「Resource Migration」(資源移轉) 一節。<citetitle></citetitle> </para>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.manage.monitor.status">
   <title>監控叢集</title>
   <para>登入後，Hawk 預設會顯示<guimenu>狀態</guimenu>螢幕。右上角的圖示扼要顯示叢集狀態。如需其他詳細資料，請參閱下列類別。</para>
   <variablelist>
    <varlistentry>
     <term>錯誤</term>
     <listitem>
      <para>只在發生錯誤時顯示。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>資源</term>
     <listitem>
      <para>顯示所設定的資源，包括其<guimenu>狀態</guimenu>、<guimenu>名稱</guimenu> (ID)、位址 (資源執行時所在的節點) 和資源代辦<guimenu>類型</guimenu>。從<guimenu>操作</guimenu>欄中，您可以觸發動作、編輯資源或檢視資源詳細資料，例如<guimenu>中繼屬性</guimenu>、<guimenu>操作</guimenu>或<guimenu>例項</guimenu>。可以觸發的動作包括 <literal>start</literal> / <literal>stop</literal>、<literal>manage</literal> / <literal>unmanage</literal>、<literal>migrate</literal> / <literal>unmigrate</literal> 或 <literal>cleanup</literal>。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>節點</term>
     <listitem>
      <para>顯示您所登入的叢集站點名下的節點，包括節點<guimenu>狀態</guimenu>和<guimenu>名稱</guimenu>。在<guimenu>維護</guimenu>和<guimenu>待命</guimenu>欄中，您可以設定或移除節點的<literal>維護</literal>或<literal>待命</literal>旗標。<guimenu>操作</guimenu>欄可用於檢視更多詳細資料，例如，是否為相應節點設定了<literal>使用率</literal>、<literal>待命</literal>或<literal>維護</literal>屬性。 </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <figure pgwide="0">
    <title>Hawk2—叢集狀態</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="hawk2-cluster-status-main.png" width="100%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="hawk2-cluster-status-main.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.manage.monitor.dash">
   <title>監控多個叢集</title>
   <para> <guimenu>儀表板</guimenu>螢幕中顯示的叢集資訊儲存在伺服器一方，並在不同叢集節點之間同步 (如果叢集節點之間設定了無密碼 SSH 存取)。如需詳細資料，請參閱<xref linkend="sec.crmreport.nonroot.ssh"/>。但是，用來執行 Hawk2 的機器甚至不需要為此而加入任何叢集，它可以是獨立的、不相關的系統。 </para>
   <procedure xml:id="pro.conf.hawk2.dashboard">
    <title>使用 Hawk2 監控多個叢集</title>
    <para>除了常見的<xref linkend="sec.conf.hawk2.req" xrefstyle="select:title"/>，還需要滿足下列前提條件才能透過 Hawk 監控多個叢集︰</para>
    <itemizedlist>
     <title>必要條件</title>
     <listitem>
      <para> 要透過 Hawk <guimenu>儀表板</guimenu>監控的所有叢集都必須執行 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">12 SP1</phrase></phrase>。Hawk 無法監控執行 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 較低版本的叢集。 </para>
     </listitem>
     <listitem>
      <para>如果您沒有在每個叢集節點上以您自己的證書 (或官方證書管理中心簽署的證書) 取代 Hawk2 的自行簽署證書，請在<emphasis>每個</emphasis>叢集中的<emphasis>每個</emphasis>節點上至少登入 Hawk2 一次。驗證證書 (或在瀏覽器中新增一個例外以使警告不再顯示)。 </para>
     </listitem>
    </itemizedlist>
    <step>
     <para>登入 Hawk2︰</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para>在左側導覽列中選取<guimenu>儀表板</guimenu>。 </para>
    </step>
    <step>
     <para>若要為多個叢集新增儀表板，請按一下<guimenu>新增叢集</guimenu>。</para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="hawk2-dashboard-add-cluster.png" width="100%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="hawk2-dashboard-add-cluster.png" width="100%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
     <substeps>
      <step>
       <para> 輸入自定<guimenu>叢集名稱</guimenu>，用於在<guimenu>儀表板</guimenu>中識別叢集。 </para>
      </step>
      <step>
       <para>輸入<guimenu>叢集中節點的主機名稱</guimenu>。</para>
      </step>
      <step>
       <para>若要指定其他選項，例如 Hawk2 的更新間隔、連接到的連接埠或是否使用 HTTPS (預設)，請按一下<guimenu>進階</guimenu>並輸入詳細資料。 </para>
      </step>
      <step>
       <para>按一下<guimenu>新增</guimenu>，確認所做的變更。</para>

      </step>
      <step>
       <para> 若要將更多叢集新增至該儀表板，請再次按一下<guimenu>新增叢集</guimenu>，然後輸入下一個叢集的詳細資料。 </para>
       <figure>
        <title>Hawk2—儀表板</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="hawk2-dashboard-multiple-clusters.png" width="100%" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="hawk2-dashboard-multiple-clusters.png" width="100%" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
     </substeps>
    </step>
    <step>
     <para> 若要從儀表板中移除某個叢集，請按一下該叢集名稱旁邊的 <literal>x</literal> 圖示。 </para>
    </step>
    <step>
     <para> 若要檢視某個叢集的詳細資料，請輸入密碼，然後按一下<guimenu>連接</guimenu>。 </para>
     <para> Hawk2 會顯示相應節點、資源和票證的狀態摘要。如果按一下叢集名稱，系統會顯示該叢集的<guimenu>狀態</guimenu>檢視窗，可用於像平常一樣管理該叢集。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
