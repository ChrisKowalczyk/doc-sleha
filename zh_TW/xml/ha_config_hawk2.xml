<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_config_hawk2.xml" xml:id="cha.conf.hawk2" version="5.0">
 <title>使用 Hawk2 設定和管理叢集資源</title>
 <info>
  <abstract>
   <para> 為了設定和管理叢集資源，<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 使用 HA Web Konsole (Hawk) 或 crm shell (crmsh) 指令行公用程式。 </para>
   <para> Hawk2 採用 Web 式使用者介面，可讓您從非 Linux 機器監控和管理自己的 Linux 叢集。此外，如果您的系統只提供了精簡的圖形使用者介面，那麼 Hawk 將是一個理想的解決方案。 </para>

   
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>編輯</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>
 <note>
  <title>Hawk 版本</title>
  <para><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 SP1 隨附了兩個 Hawk 版本：</para>
  <itemizedlist>
   <listitem>
    <para>Hawk 版本 <literal>1</literal> (包含在 RPM 套件 <systemitem class="resource">hawk</systemitem> 中)。如果需要本版本 Hawk 的文件，請參閱<xref linkend="cha.ha.config.hawk"/>。</para>
   </listitem>
   <listitem>
    <para>Hawk 版本 <literal>2</literal> (包含在 RPM 套件 <systemitem class="resource">hawk2</systemitem> 中)。本章將會介紹此版本。</para>
   </listitem>
  </itemizedlist>
 </note>

 <sect1 xml:id="sec.conf.hawk2.req">
  <title>Hawk2 要求</title>
  <para>使用者要想登入 Hawk，必須先滿足下列要求︰</para>

  <itemizedlist>
   <listitem>
    <para>要透過 Hawk2 連接的所有叢集節點都必須已安裝 <systemitem class="resource">hawk2</systemitem> 套件。</para>
   </listitem>
   <listitem>
    <para> 而在要透過 Hawk2 存取某個叢集節點的機器上，只需有一個啟用了 JavaScript 和 Cookie 的 (圖形) 網頁瀏覽器即可建立連接。 </para>
   </listitem>
   <listitem>
    <para> 若要使用 Hawk，您要透過 Web 介面與之連接的節點上必須啟動相應的 Web 服務。請參閱<xref linkend="pro.ha.hawk2.service"/>。</para>
    <para> 如果您已使用 <systemitem class="resource">ha-cluster-bootstrap</systemitem> 套件中的程序檔設定了叢集，則 Hawk2 服務現已啟動。 </para>
   </listitem>
   <listitem>
    <para> Hawk 使用者必須是 <systemitem class="groupname">haclient</systemitem> 群組的成員。安裝程序會建立名為 <systemitem class="username">hacluster</systemitem> 的 Linux 使用者，該使用者已新增至 <systemitem class="groupname">haclient</systemitem> 群組中。使用 <command>ha-cluster-init</command> 程序檔進行設定時，會為 <systemitem class="username">hacluster</systemitem> 使用者設定預設密碼。 </para>
    <para> 在啟動 Hawk2 之前，請設定或變更 <systemitem>hacluster</systemitem> 使用者的密碼。或者，建立一個屬於 <systemitem class="groupname">haclient</systemitem> 群組的新使用者。 </para>
    <para> 請在您要使用 Hawk2 與之連接的所有節點上執行此操作。 </para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro.ha.hawk2.service">
   <title>啟動 Hawk 服務</title>
   <step>
    <para> 在您要與之連接的節點上，開啟外圍程序並以 <systemitem class="username">root</systemitem> 身分登入。 </para>
   </step>
   <step>
    <para> 輸入以下指令檢查服務的狀態 </para>
    <screen><prompt role="root">root # </prompt><command>systemctl</command> status hawk</screen>
   </step>
   <step>
    <para> 如果服務沒有執行，則使用以下指令將其啟動 </para>
    <screen><prompt role="root">root # </prompt><command>systemctl</command> start hawk</screen>
    <para> 如果想讓 Hawk 在系統開機時自動啟動，請執行以下指令： </para>
    <screen><prompt role="root">root # </prompt><command>systemctl</command> enable hawk</screen>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.conf.hawk2.login">
  <title>登入</title>
  <para> Hawk2 Web 介面使用 HTTPS 通訊協定和連接埠 <literal>7630</literal>。 </para>
  
  <note>
   <title>透過虛擬 IP 存取 Hawk2</title>
   <para>如果您希望無論平時連接的叢集節點關閉與否，都能存取 Hawk2，則可以為 Hawk2 設定一個虛擬 IP 位址 (<literal>IPaddr</literal> 或 <literal>IPaddr2</literal>) 做為叢集資源。該位址無需任何特殊組態設定。</para>
  </note>
  <procedure xml:id="pro.ha.hawk2.login">
   <title>登入 Hawk2 Web 介面</title>

   <step>
    <para> 在任一機器上，啟動網頁瀏覽器並確定已啟用 JavaScript 和 Cookie。 </para>
   </step>
   <step>
    <para> 輸入任一執行 Hawk Web 服務之叢集節點的 IP 位址或主機名稱做為 URL。或者，輸入叢集操作人員可能已設定之任何 <literal>IPaddr(2)</literal> 資源的位址： </para>
    <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    <note>
     <title>證書警告</title>
     <para> 當您首次嘗試存取該 URL 時，如果系統顯示證書警告，則表示使用了自行簽署的證書。依預設，自行簽署的證書不被視為可信證書。 </para>
     <para> 請咨詢您的叢集操作人員取得證書詳細資料，以驗證該證書。 </para>
     <para> 若仍要繼續，您可以在瀏覽器中新增一個例外以略過此警告。 </para>
     <para> 如需關於如何將自行簽署的證書取代為官方證書管理中心所簽署證書的資訊，請參閱<xref linkend="vle.ha.hawk.certificate"/>。 </para>
    </note>
   </step>
   <step>
    <para> 在 Hawk2 登入螢幕中，輸入 <guimenu>hacluster</guimenu> 使用者 (或任何屬於群組 <guimenu>haclient</guimenu> 的其他使用者) 的<systemitem class="username">使用者名稱</systemitem>和<systemitem class="groupname">密碼</systemitem>。 </para>
   </step>
   <step>
    <para> 按一下<guimenu>登入</guimenu>。 </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.conf.hawk2.overview">
  <title>Hawk 概觀︰主要元素</title>

  <para>登入 Hawk2 後，左側會顯示導覽列，右側則顯示頂層列，並附有若干連結。</para>


  <note>
   <title>Hawk2 的可用功能</title>
   <para> 依預設，以 <systemitem class="username">root</systemitem> 或 <systemitem class="username">hacluster</systemitem> 身分登入的使用者對於所有叢集組態任務都擁有完整的讀-寫存取權限。不過，您可以使用<xref linkend="cha.ha.acl" xrefstyle="select:title"/> (ACL) 來定義精細的存取權限。 </para>
   <para> 如果 CRM 中啟用了 ACL，則 Hawk2 的可用功能取決於指定給您的使用者角色及其所指定的存取權限。此外，Hawk2 中的下列功能僅限由使用者 <systemitem class="username">hacluster</systemitem> 執行︰使用<guimenu>歷程總管</guimenu>。</para>
  </note>


  <sect2 xml:id="sec.conf.hawk2.overview.leftnav">
   <title>左側導覽列</title>

   <variablelist>
    <varlistentry>
     <term><guimenu>管理</guimenu></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>狀態</guimenu>︰扼要顯示當前的叢集狀態 (與 crmsh 上的 <command>crm status</command> 類似)。如需詳細資料，請參閱<xref linkend="sec.conf.hawk2.manage.monitor.status"/>。系統以幾乎即時的速度重新整理螢幕，因此節點或資源一旦出現任何狀態變更，都會幾乎立刻反應出來。</para>
       </listitem>
       <listitem>
        <para>
         <guimenu>儀表板</guimenu>︰可讓您監控多個叢集 (如果您設定了地理叢集，則這些叢集還可以位於不同站點)。如需詳細資料，請參閱<xref linkend="sec.conf.hawk2.manage.monitor.dash"/>。系統以幾乎即時的速度重新整理螢幕，因此節點或資源一旦出現任何狀態變更，都會幾乎立刻反應出來。</para>
       </listitem>
       
       <listitem>
        <para>
         <guimenu>歷程</guimenu>︰打開可以用來產生叢集報告的<guimenu>歷程總管</guimenu>。</para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>組態</guimenu></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>新增資源</guimenu>︰打開資源組態螢幕。如需詳細資料，請參閱<xref linkend="sec.conf.hawk2.rsc"/>。 </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>新增條件約束</guimenu>︰打開條件約束組態螢幕。如需詳細資料，請參閱<xref linkend="sec.conf.hawk2.cons"/>。</para>
       </listitem>
       <listitem>
        <para>
         <guimenu>選擇精靈</guimenu>︰有大量精靈可供您選取，這些精靈會全程引導您針對特定工作負載 (例如某個 DRBD 區塊裝置) 建立資源。如需詳細資料，請參閱<xref linkend="sec.conf.hawk2.rsc.wizard"/>。</para>
       </listitem>
       <listitem>
        <para>
         <guimenu>編輯</guimenu>︰可讓您編輯節點名稱和屬性、資源和條件約束。</para>
       </listitem> 
       <listitem>
        <para><guimenu>組態</guimenu>︰可打開<guimenu>叢集組態</guimenu>螢幕，用於修改全域叢集選項。如需詳細資料，請參閱<xref linkend="sec.conf.hawk2.cluster.config"/>。</para>
       </listitem>
       <listitem>
        <para><guimenu>指令記錄</guimenu>︰可列出近期由 Hawk2 執行的 crmsh 指令。 </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>存取控制</guimenu></term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>角色</guimenu>︰所打開的螢幕可用於為存取控制清單 (一組用於描述 CIB 存取權限的規則) 建立角色。 </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>目標</guimenu>︰所打開的螢幕可用於為存取控制清單建立目標 (系統使用者)，以及為目標指定角色。 </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.overview.toprow">
   <title>頂層導覽</title>
   <para>Hawk 的頂層列顯示下列項目︰</para>
   <itemizedlist>
    <listitem>
     <para><guimenu>叢集詳細資料</guimenu>︰按一下此項可打開幾乎即時重新整理的詳細資料清單，以此幾乎即時地反應時間點和狀態的變更。 </para></listitem>
    <listitem>
     <para><guimenu>模擬器</guimenu>︰按一下此項可啟用或停用模擬器模式。  </para>
    </listitem>
    <listitem>
     <para><guimenu>設定檔</guimenu>︰按一下此項可變更您對 Hawk2 的語言偏好設定。</para>
    </listitem>
    <listitem>
     <para><guimenu>說明</guimenu>︰按一下此項可存取在您透過 Hawk2 連接的節點上所安裝的 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 手冊 (HTML 和 PDF 版本)。</para>
    </listitem>
    <listitem>
     <para><guimenu>登出</guimenu>︰按一下此項可登出。</para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.conf.hawk2.cluster.config">
  <title>設定全域叢集選項</title>
  <para> 全域叢集選項控制叢集在遇到特定情況時的運作方式。這些選項分為不同的集合，您可以使用 Hawk 與 crmsh 等叢集管理工具來檢視和修改它們。一般情況下，可以保留預先定義的值。但是，為了讓叢集的關鍵功能正常運作，還需要在執行基本叢集設定後調整以下參數： </para>
  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="sec.ha.config.basics.global.quorum" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec.ha.config.basics.global.stonith" xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro.conf.hawk2.global">
   <title>修改全域叢集選項</title>
   <step>
    <para>登入 Hawk2︰</para>
    <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>在左側導覽列中選取<menuchoice> <guimenu>管理</guimenu> <guimenu>組態</guimenu> </menuchoice>。</para>
    <para><guimenu>叢集組態</guimenu>螢幕隨即打開。它會顯示全域叢集選項及其當前的值。 </para>
    <para>若要在螢幕右側顯示參數的簡短描述，請將滑鼠懸停在參數上方。 </para>
    <figure pgwide="0">
     <title>Hawk — 叢集組態</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk2-cluster-config.png" width="100%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk2-cluster-config.png" width="100%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para> 檢查 <guimenu>no-quorum-policy</guimenu> 和 <guimenu>stonith-enabled</guimenu> 的值，必要時予以調整︰ </para>
    <substeps performance="required">
     <step>
      <para> 將 <guimenu>no-quorum-policy</guimenu> 設為適當的值。對於雙節點叢集，該值必須設定為 <literal>ignore</literal>。請參閱 <xref linkend="sec.ha.config.basics.global.quorum"/>，以取得詳細資料。
      </para>
     </step>
     <step>
      <para> 如果出於某種原因需要停用圍籬區隔，請將 <guimenu>stonith-enabled</guimenu> 設定為 <literal>no</literal>。此全域選項預設為 <literal>true</literal>，因為正常的叢集運作需要使用 STONITH 裝置。依據預設值，如果未定義 STONITH 資源，叢集將拒絕啟動任何資源。 </para>
      <important>
       <title>沒有 STONITH 則不提供支援</title>
       <para> 系統不支援沒有 STONITH 的叢集。 </para>
      </important>
     </step>
     <step>
      <para> 若要從叢集組態中移除某個參數，請按一下該參數旁邊的減號圖示。如果某個參數被刪除，叢集會將該參數視為具有預設值。 </para>
     </step>
     <step>
      <para> 若要為叢集組態新增新的參數，請從下拉式方塊中選擇一個參數，然後按一下加號圖示。 </para>
     </step>
    </substeps>
   </step>
   <step>
    <para> 如果您需要變更<guimenu>資源預設值</guimenu>或<guimenu>操作預設值</guimenu>，請執行下列步驟： </para>
    <substeps performance="required">
     <step>
      <para> 若要調整值，請在下拉式方塊中選取其他值，或直接編輯該值。 </para>
     </step>
     <step>
      <para> 若要新增新的資源預設值或操作預設值，請從空白下拉式清單中選擇一個項目，然後按一下加號圖示並輸入值。如果已定義預設值，Hawk2 會自動提供這些預設值。 </para>
     </step>
     <step>
      <para> 若要完全移除某個參數，請按一下該參數旁邊的減號圖示。如果沒有為<guimenu>資源預設值</guimenu>和<guimenu>操作預設值</guimenu>指定值，叢集會使用<xref linkend="sec.ha.config.basics.meta.attr"/> 及<xref linkend="sec.ha.config.basics.operations"/> 中所述的預設值。 </para>
     </step>
    </substeps>
   </step>
   <step>
    <para> 確認您的變更。 </para>
   </step>
  </procedure>
 </sect1>
 <xi:include href="ha_hawk2_rsc_i.xml"/>
 <xi:include href="ha_hawk2_cons_i.xml"/>
 <xi:include href="ha_hawk2_manage_i.xml"/>
</chapter>
