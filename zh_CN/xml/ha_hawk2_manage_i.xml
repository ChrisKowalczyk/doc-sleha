<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_hawk2_manage_i.xml" version="5.0" xml:id="sec.conf.hawk2.manage">
  
  <title>管理群集资源</title>
  
    <info>
   <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
    <dm:maintainer/>
    <dm:status>编辑</dm:status>
    <dm:deadline/>
    <dm:priority/>
    <dm:translation>yes</dm:translation>
    <dm:languages/>
    <dm:release/>
    <dm:repository/>
   </dm:docmanager>
    </info>
 
  <para> 除了配置群集资源以外，Hawk 还可用于从<guimenu>状态</guimenu>屏幕管理现有资源。有关该屏幕的一般性概述，请参见<xref linkend="sec.conf.hawk2.manage.monitor.status"/>。</para>
  <sect2 xml:id="sec.conf.hawk2.manage.start">
   <title>启动资源</title>
   <para> 启动群集资源之前，应确保资源设置正确。例如，如果要使用 Apache 服务器作为群集资源，请先设置 Apache 服务器。完成 Apache 配置，然后才能启动群集中的相应资源。 </para>
   <note>
    <title>不要处理由群集管理的服务</title>
    <para> 通过 High Availability Extension 管理资源时，不得以其他方式（例如，在群集外手动或者引导时或重引导时）启动或停止该资源。High Availability Extension 软件负责所有服务的启动或停止操作。 </para>
    <para> 但是，如果要检查服务是否正确配置，可手动启动该服务，但请确保在 High Availability 接管前再次停止该服务。 </para>
    <para> 要对群集当前管理的资源进行干预，请先将资源设置为<literal>维护模式</literal>。<remark>taroth 2015-12-04: ToDo: add
      for next revision: krig - how does that work with hawk2? does it work already? 
      I searched in the Operations column for a resource but could not find anything there...
      krig 2015-12-08: Ah! That's the "Unmanage" operation on resources.</remark>
    </para>
   </note>
   <para> 使用 Hawk 创建资源时，可通过 <literal>target-role</literal> 元属性设置其初始状态。如果将其值设置为 <literal>stopped</literal>，则该资源在创建后不会自动启动。 </para>
   <procedure xml:id="pro.hawk2.rsc.start">
    <title>启动新资源</title>
    <step>
     <para>登录 Hawk2：</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 在左侧导航栏中，选择<guimenu>状态</guimenu>。<guimenu>资源</guimenu>列表还会显示<guimenu>状态</guimenu>。 </para>
    </step>
    <step>
     <para> 选择要启动的资源，然后在其<guimenu>操作</guimenu>列中，单击<guimenu>启动</guimenu>图标。要继续，请确认显示的消息。 </para>
     <para>资源启动后，Hawk 会将资源的<guimenu>状态</guimenu>更改为绿色，并显示当前运行该资源的节点。 </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec.conf.hawk2.manage.cleanup">
   <title>清理资源</title>
   <para> 如果资源失败，它会自动重启动，但每次失败都会增加资源的失败计数。 </para>
   <para> 如果已为资源设置 <literal>migration-threshold</literal>，当失败次数达到迁移阈值时，节点将不再运行该资源。 </para>
   <para> 资源的失败计数可以通过系统自动重设置（通过设置资源的 <literal>failure-timeout</literal> 选项），也可如下所述手动重设置。 </para>
   <procedure xml:id="pro.hawk2.clean">
    <title>清理资源</title>
    <step>
     <para>登录 Hawk2：</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 在左侧导航栏中，选择<guimenu>状态</guimenu>。<guimenu>资源</guimenu>列表还会显示<guimenu>状态</guimenu>。 </para>
    </step>
    <step>
     <para> 转到要清理的资源。在<guimenu>操作</guimenu>列中，单击向下箭头按钮并选择<guimenu>清理</guimenu>。要继续，请确认显示的消息。 </para>
     <para>如此即会执行 <command>crm resource cleanup</command> 命令并在所有节点上清理该资源。 </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec.conf.hawk2.manage.remove">
   <title>删除群集资源</title>
   <para> 如果需要从群集中删除资源，请遵循以下过程以免出现配置错误： </para>
   <procedure xml:id="pro.hawk2.rsc.rm">
    <title>删除群集资源</title>
    <step>
     <para> 按<xref linkend="pro.hawk2.clean"/>中所述清理所有节点上的资源。
     </para>
    </step>
    <step>
     <para>停止资源：</para>
     <substeps>
      <step>
       <para> 在左侧导航栏中，选择<guimenu>状态</guimenu>。<guimenu>资源</guimenu>列表还会显示<guimenu>状态</guimenu>。 </para>
      </step>
      <step>
       <para>在<guimenu>操作</guimenu>列中，单击资源旁边的<guimenu>停止</guimenu>按钮。 </para>
      </step>
      <step>
       <para>要继续，请确认显示的消息。</para>
       <para>一旦资源停止，<guimenu>状态</guimenu>列即会反映此变化。</para>
      </step>
     </substeps>
    </step>
    <step>
     <para>删除资源：</para>
     <substeps>
      <step>
       <para> 在左侧导航栏中，选择<guimenu>编辑</guimenu>。 </para>
      </step>
      <step>
       <para>在<guimenu>资源</guimenu>列表中，转到相应资源。在<guimenu>操作</guimenu>列中，单击资源旁边的<guimenu>删除</guimenu>图标。</para>
      </step>
      <step>
       <para>要继续，请确认显示的消息。</para>
      </step>
     </substeps>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.manage.migrate">
   <title>迁移群集资源</title>
   <para> 如<xref linkend="sec.conf.hawk2.failover"/>中所述，如果软件或硬件发生故障，群集会根据可自定义的特定参数（例如，迁移阈值或资源粘性），自动进行资源故障转移（迁移）。您还可以手动将资源迁移到群集中的其他节点。或者，可以将它移出当前节点，并让群集决定要将它放置到哪个位置。 </para>
   <procedure xml:id="pro.hawk2.rsc.migrate">
    <title>手动迁移资源</title>
    <step>
     <para>登录 Hawk2：</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 在左侧导航栏中，选择<guimenu>状态</guimenu>。<guimenu>资源</guimenu>列表还会显示<guimenu>状态</guimenu>。 </para>
    </step>
    <step>
     <para>在<guimenu>资源</guimenu>列表中，选择相应资源。</para>
    </step>
    <step>
     <para><remark>taroth 2015-12-07: krig, is there any way to select which node to migrate the
       resource to? krig: also, Hawk1 has two options: "Move" (lets you select where to move the rsc
       to and creates a location constraint with an INFINITY score for the destination node) and
       "Away from current node" (creates a location constraint with a -INFINITY score for the
       current node) - is there anything like this with Hawk2? - taroth 2015-12-08: on behalf of
       krig, filed https://bugzilla.suse.com/show_bug.cgi?id=958386 for this </remark>在<guimenu>操作</guimenu>列中，单击向下箭头按钮并选择<guimenu>迁移</guimenu>。要继续，请确认显示的消息。</para>
    </step>
   </procedure>
   <para> 要使资源重新移回，请按如下操作： </para>
   <procedure xml:id="pro.hawk2.rsc.migrate.back">
    <title>取消迁移资源</title>

    <step>
     <para>登录 Hawk2：</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> 在左侧导航栏中，选择<guimenu>状态</guimenu>。<guimenu>资源</guimenu>列表还会显示<guimenu>状态</guimenu>。 </para>
    </step>
    <step>
     <para>在<guimenu>资源</guimenu>列表中，转到相应资源。</para>
    </step>
    <step>
     <para>在<guimenu>操作</guimenu>列中，单击向下箭头按钮并选择<guimenu>取消迁移</guimenu>。要继续，请确认显示的消息。</para>
     <para>
        这将使用 <command>crm_resource&#xa0;</command><option>-U</option> 命令。资源可以移回到其原始位置，也可以留在当前位置（取决于资源黏性）。</para>
    </step>
   </procedure>

   <para> 有关详细信息，请参见 <link xlink:href="http://www.clusterlabs.org/doc/"/> 上的《<citetitle>Pacemaker Explained</citetitle>》（Pacemaker 配置说明）。请参见<citetitle>“Resource Migration”</citetitle>（资源迁移）一章。 </para>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.manage.monitor.status">
   <title>监视群集</title>
   <para>您登录后，Hawk 默认会显示<guimenu>状态</guimenu>屏幕。右上角的一个图标会一目了然地显示群集状态。如需更多细节，请查看以下类别：</para>
   <variablelist>
    <varlistentry>
     <term>错误</term>
     <listitem>
      <para>仅显示是否发生了错误。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>资源</term>
     <listitem>
      <para>显示配置的资源，包括它们的<guimenu>状态</guimenu>、<guimenu>名称</guimenu> (ID)、位置（运行资源的节点）和资源代理<guimenu>类型</guimenu>。在<guimenu>操作</guimenu>列中，您可以触发一些操作，编辑资源或查看资源细节，例如<guimenu>元属性</guimenu>、<guimenu>操作</guimenu>或<guimenu>实例</guimenu>。可以触发的操作包括 <literal>start</literal> / <literal>stop</literal>、<literal>manage</literal> / <literal>unmanage</literal>、<literal>migrate</literal> / <literal>unmigrate</literal> 或 <literal>cleanup</literal>。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>节点</term>
     <listitem>
      <para>显示属于您登录的群集站点的节点，包括节点的<guimenu>状态</guimenu>和<guimenu>名称</guimenu>。在<guimenu>维护</guimenu>和<guimenu>待机</guimenu>列中，您可以为节点设置或去除<literal>维护</literal>或<literal>待机</literal>标志。<guimenu>操作</guimenu>列可用于查看更多细节，例如，查看是否为相应节点设置了<literal>利用率</literal>、<literal>待机</literal>或<literal>维护</literal>属性。 </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <figure pgwide="0">
    <title>Hawk2 - 群集状态</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="hawk2-cluster-status-main.png" width="100%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="hawk2-cluster-status-main.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.manage.monitor.dash">
   <title>监视多个群集</title>
   <para> <guimenu>仪表板</guimenu>屏幕中显示的群集信息储存在服务器端，并会在群集节点之间同步（如果在群集节点间配置了无口令 SSH 访问）。有关详细信息，请参见<xref linkend="sec.crmreport.nonroot.ssh"/>。然而，运行 Hawk2 的计算机甚至不需要属于任何群集也可实现该目的 - 该计算机可以是不相关的独立系统。 </para>
   <procedure xml:id="pro.conf.hawk2.dashboard">
    <title>使用 Hawk2 监视多个群集</title>
    <para>除了一般的 <xref linkend="sec.conf.hawk2.req" xrefstyle="select:title"/>之外，还需要满足以下先决条件才能使用 Hawk 监视多个群集：</para>
    <itemizedlist>
     <title>先决条件</title>
     <listitem>
      <para> 要通过 Hawk 的<guimenu>仪表板</guimenu>监视的所有群集都必须运行 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">12 SP1</phrase></phrase>。无法监视运行旧版 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 的群集。 </para>
     </listitem>
     <listitem>
      <para>如果您没有在每个群集节点上用您自己的证书（或官方证书颁发机构签名的证书）替换 Hawk2 的自我签名证书，请在<emphasis>每个</emphasis>群集的<emphasis>每个</emphasis>节点上至少登录一次 Hawk2。验证证书（或在浏览器中添加例外以绕过警告）。 </para>
     </listitem>
    </itemizedlist>
    <step>
     <para>登录 Hawk2：</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para>在左侧导航栏中，选择<guimenu>仪表板</guimenu>。 </para>
    </step>
    <step>
     <para>要添加多个群集的仪表板，请单击<guimenu>添加群集</guimenu>。</para>
     <informalfigure>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="hawk2-dashboard-add-cluster.png" width="100%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="hawk2-dashboard-add-cluster.png" width="100%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </informalfigure>
     <substeps>
      <step>
       <para> 输入自定义的<guimenu>群集名称</guimenu>，用于在<guimenu>仪表板</guimenu>中标识该群集。 </para>
      </step>
      <step>
       <para>输入<guimenu>群集中节点的主机名</guimenu>。</para>
      </step>
      <step>
       <para>要指定更多选项（例如 Hawk2 的更新间隔、要连接的端口或是否使用 HTTPS（默认值）），请单击<guimenu>高级</guimenu>并输入细节。 </para>
      </step>
      <step>
       <para>单击<guimenu>添加</guimenu>确认更改。</para>

      </step>
      <step>
       <para> 要将更多群集添加至仪表板，请再次单击<guimenu>添加群集</guimenu>，然后输入下一个群集的细节。 </para>
       <figure>
        <title>Hawk2 - 仪表板</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="hawk2-dashboard-multiple-clusters.png" width="100%" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="hawk2-dashboard-multiple-clusters.png" width="100%" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
     </substeps>
    </step>
    <step>
     <para> 要从仪表板中去除某个群集，请单击该群集名称旁边的 <literal>x</literal> 图标。 </para>
    </step>
    <step>
     <para> 要查看群集的相关细节，请输入口令并单击<guimenu>连接</guimenu>。 </para>
     <para> Hawk2 将显示一份摘要，包含相应节点的状态、资源和票据。单击节点名称会显示该节点的<guimenu>状态</guimenu>视图，您可以从该处照常管理节点。</para>
    </step>
   </procedure>
  </sect2>
 </sect1>
